<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>KRI Method • gsm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="KRI Method">
<link href="pkgdown/extra.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Data Model</h6></li>
    <li><a class="dropdown-item" href="../articles/DataModel.html">Data Model</a></li>
    <li><a class="dropdown-item" href="../articles/Cookbook.html">Cookbook</a></li>
    <li><a class="dropdown-item" href="../articles/DataAnalysis.html">Step-by-Step Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/DataReporting.html">Step-by-Step Reporting Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/gsmExtensions.html">gsm Extensions</a></li>
    <li><a class="dropdown-item" href="../articles/KRIMethod.html">KRI Method</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quality</h6></li>
    <li><a class="dropdown-item" href="../articles/QualificationWorkflow.html">Qualification Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/Qualification.html">Qualification Report for the {gsm} R Package</a></li>
    <li><a class="dropdown-item" href="../articles/ContributorGuidelines.html">Contributor Guidelines</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-sample-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Sample Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-sample-reports">
<li><a class="dropdown-item" href="../report_kri_site.html">Site Report</a></li>
    <li><a class="dropdown-item" href="../report_kri_country.html">Country Report</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Gilead-BioStats/gsm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>KRI Method</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Gilead-BioStats/gsm/blob/main/vignettes/articles/KRIMethod.Rmd" class="external-link"><code>vignettes/articles/KRIMethod.Rmd</code></a></small>
      <div class="d-none name"><code>KRIMethod.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette outlines the statistical methods used to evaluate Key
Risk Indicators (KRIs) in {gsm}. KRIs are metrics that allow users to
measure pre-defined risks and determine the level of observed risk to
data quality and patient safety in a clinical trial. The {gsm} package
implements a standardized data pipeline to facilitate KRI analysis.
Other vignettes provide an overview of this framework (<a href="../">1</a>, <a href="Cookbook.html">2</a> <a href="DataModel.html">3</a>, <a href="DataAnalysis.html">4</a>, <a href="DataReporting.html">5</a>), and the statistical methods for this
process are described in detail below.</p>
<p>GSM calculates KRIs by defining a numerator and a denominator for
each metric. Then by default, GSM calculates z-scores using a normal
approximation with adjustment for over-dispersion to assign risk
levels.</p>
<p>For KRIs that are percentages (binary outcome), the numerator is the
# of events and the denominator is the # of total participants, and we
then apply the normal approximation of the binomial distribution to
determine a risk level.</p>
<p>For KRIs that are rates (count outcome), the numerator is the # of
events and the denominator is the total participant exposure or study
duration, and we then apply the normal approximation of the Poisson
distribution to determine a risk level.</p>
<p>Alternative statistical methods to calculate standardized scores are
also available in {gsm}, including the Identity, Fisher and Poisson
methods. More details are provided below.</p>
</div>
<div class="section level2">
<h2 id="statistical-methods">Statistical Methods<a class="anchor" aria-label="anchor" href="#statistical-methods"></a>
</h2>
<div class="section level3">
<h3 id="the-normal-approximation-method">1. The Normal Approximation Method<a class="anchor" aria-label="anchor" href="#the-normal-approximation-method"></a>
</h3>
<div class="section level4">
<h4 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h4>
<p>This method applies normal approximation of binomial distribution to
the binary outcome KRIs, or normal approximation of Poisson distribution
for the rate outcome KRIs (the sample sizes or total exposure of the
sites) to assess data quality and safety. The control limits based on
the asymptotic normal approximation are constructed to as risk
thresholds for identifying site-level risks.</p>
<p>Reference: Zink, Richard C., Anastasia Dmitrienko, and Alex
Dmitrienko. <strong>Rethinking the clinically based thresholds of
TransCelerate BioPharma for risk-based monitoring.</strong>
<em>Therapeutic Innovation &amp; Regulatory Science</em> 52, no. 5
(2018): 560-571.</p>
</div>
<div class="section level4">
<h4 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h4>
<div class="section level5">
<h5 id="binary">Binary<a class="anchor" aria-label="anchor" href="#binary"></a>
</h5>
<p>Consider the problem of monitoring KRIs with binary outcomes, such as
protocol deviation or discontinuation from the study, across multiple
sites in a clinical trial. Assume that there are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
sites with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>i</mi></msub><annotation encoding="application/x-tex">n_i</annotation></semantics></math>
patients at the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
th site,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">i = 1, 2, \dots, m</annotation></semantics></math>.
Denote the total number of patients in the study by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">n=\sum_{i=1}^m n_i</annotation></semantics></math>.
Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">X_{ij}</annotation></semantics></math>
signify the outcome of interest for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
th patient at the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
th site, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">X_{ij}=1</annotation></semantics></math>
indicates that an event has occurred and indicates that an event has not
occurred. Finally, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>i</mi></msub><annotation encoding="application/x-tex">p_i</annotation></semantics></math>
denote the site-level proportion at the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
th site. Monitoring tools focus on testing the null hypothesis of
consistency of the true site-level proportion across multiple sites.
Specifically, the null hypothesis states that the site-level proportion
of the binary outcome is constant across the sites, that is,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>p</mi><mn>1</mn></msub><mo>=</mo><mi>…</mi><mo>=</mo><msub><mi>p</mi><mi>m</mi></msub><mo>=</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">H_0: p_1 = \dots = p_m = p</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is the common proportion. This common proportion can be estimated as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>p</mi><mo accent="true">̂</mo></mover><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></msubsup><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\hat{p} = \frac{1}{n}\sum_{i=1}^m\sum_{j=1}^{n_i}X_{ij}</annotation></semantics></math>.</p>
<p>The control limits are computed using confidence limits based on an
asymptotic normal approximation. A 95% confidence interval is obtained
if the significance level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha=0.05</annotation></semantics></math>.
Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></msubsup><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_i=\sum_{j=1}^{n_i}X_{ij}</annotation></semantics></math>
represent the total number of events that occur and let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>p</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>=</mo><msub><mi>X</mi><mi>i</mi></msub><mi>/</mi><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\hat{p}_i=X_i/n_i</annotation></semantics></math>
denote the estimated event rate at the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
th site. The asymptotic
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mi>–</mi><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">100(1 – \alpha)%</annotation></semantics></math>
confidence interval for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>i</mi></msub><annotation encoding="application/x-tex">p_i</annotation></semantics></math>
is given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>p</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>−</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><msqrt><mfrac><mrow><msub><mover><mi>p</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mover><mi>p</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msub><mi>n</mi><mi>i</mi></msub></mfrac></msqrt><mo>≤</mo><msub><mi>p</mi><mi>i</mi></msub><mo>≤</mo><msub><mover><mi>p</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>+</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><msqrt><mfrac><mrow><msub><mover><mi>p</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mover><mi>p</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msub><mi>n</mi><mi>i</mi></msub></mfrac></msqrt></mrow><annotation encoding="application/x-tex">
\hat{p}_i-z_{1-\alpha/2}\sqrt{\frac{\hat{p}_i(1-\hat{p}_i)}{n_i}} \leq p_i \leq \hat{p}_i+z_{1-\alpha/2}\sqrt{\frac{\hat{p}_i(1-\hat{p}_i)}{n_i}}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><annotation encoding="application/x-tex">z_{1-\alpha/2}</annotation></semantics></math>
is the upper percentile of the standard normal distribution. To
construct the control limits for the observed event rate at this site,
the estimated event rate is forced to be equal to the overall event rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>p</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><annotation encoding="application/x-tex">\hat{p}_i</annotation></semantics></math>.
This means that the lower (l) and upper (u) asymptotic control limits
for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
th site are defined as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>l</mi><mi>i</mi></msub><mo>=</mo><mover><mi>p</mi><mo accent="true">̂</mo></mover><mo>−</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><msqrt><mfrac><mrow><mover><mi>p</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mover><mi>p</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msub><mi>n</mi><mi>i</mi></msub></mfrac></msqrt></mrow><annotation encoding="application/x-tex">l_i=\hat{p}-z_{1-\alpha/2}\sqrt{\frac{\hat{p}(1-\hat{p})}{n_i}}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>i</mi></msub><mo>=</mo><mover><mi>p</mi><mo accent="true">̂</mo></mover><mo>+</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><msqrt><mfrac><mrow><mover><mi>p</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mover><mi>p</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msub><mi>n</mi><mi>i</mi></msub></mfrac></msqrt></mrow><annotation encoding="application/x-tex">u_i=\hat{p}+z_{1-\alpha/2}\sqrt{\frac{\hat{p}(1-\hat{p})}{n_i}}</annotation></semantics></math>,
respectively. Asymptotic control limits may not be reliable in smaller
clinical trials, so exact limits for an event rate may be
preferable.</p>
</div>
<div class="section level5">
<h5 id="rate">Rate<a class="anchor" aria-label="anchor" href="#rate"></a>
</h5>
<p>Assume that the distribution of number of events up to time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
is Poisson with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\lambda t</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
is the event rate for a given unit of time. For the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
th site with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mi>i</mi></msub></msubsup><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_i=\sum_{j=1}^{N_i}X_{ij}</annotation></semantics></math>
events and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>i</mi></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mi>i</mi></msub></msubsup><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_i=\sum_{j=1}^{N_i}t_{ij}</annotation></semantics></math>
exposure, define the exposure-adjusted incidence rate (EAIR) as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>λ</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>=</mo><mfrac><msub><mi>X</mi><mi>i</mi></msub><msub><mi>T</mi><mi>i</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">\hat{\lambda}_i=\frac{X_i}{T_i}</annotation></semantics></math>.
For all sites, define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msub><mi>X</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">X=\sum_{i=1}^{m}X_{i}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">T=\sum_{i=1}^{m}t_{i}</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>λ</mi><mo accent="true">̂</mo></mover><mo>=</mo><mfrac><mi>X</mi><mi>T</mi></mfrac></mrow><annotation encoding="application/x-tex">\hat{\lambda}=\frac{X}{T}</annotation></semantics></math>.
Under a normal approximation,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mi>–</mi><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">100(1 – a)%</annotation></semantics></math>
confidence interval for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
th site is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>λ</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>−</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><msqrt><mfrac><msub><mover><mi>λ</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><msub><mi>T</mi><mi>i</mi></msub></mfrac></msqrt><mo>≤</mo><msub><mi>p</mi><mi>i</mi></msub><mo>≤</mo><msub><mover><mi>λ</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>+</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><msqrt><mfrac><msub><mover><mi>λ</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><msub><mi>T</mi><mi>i</mi></msub></mfrac></msqrt></mrow><annotation encoding="application/x-tex">
\hat{\lambda}_i-z_{1-\alpha/2}\sqrt{\frac{\hat{\lambda}_i}{T_i}} \leq p_i \leq \hat{\lambda}_i+z_{1-\alpha/2}\sqrt{\frac{\hat{\lambda}_i}{T_i}}
</annotation></semantics></math>. For these funnel plots accounting for
exposure, the x-axis representing the site sample size
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>)
in the above examples is replaced by the total exposure time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>.
To develop a funnel plot, fix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>λ</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>=</mo><mover><mi>λ</mi><mo accent="true">̂</mo></mover></mrow><annotation encoding="application/x-tex">\hat{\lambda}_i=\hat{\lambda}</annotation></semantics></math>,
and vary
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">min(T_i)</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">max(T_i)</annotation></semantics></math>
to compute the control limits. As an area of future research, the work
of Chan and Wang (2009) may suggest methods appropriate for computing an
exact confidence interval for the EAIR. Finally, similar methods can be
applied for a count-type endpoint
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">X_{ij}</annotation></semantics></math>,
where tij would denote the time on study for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
th patient at the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
th site.</p>
</div>
</div>
<div class="section level4">
<h4 id="kri-metric-and-z-score">KRI Metric and Z-score<a class="anchor" aria-label="anchor" href="#kri-metric-and-z-score"></a>
</h4>
<p>The KRI metric along with a KRI score are created for each site to
measure the level of observed risk to data quality and patient safety in
a clinical trial. For scoring purposes, Z-scores from the normal
approximation are calculated and defined as such:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><msqrt><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt></mfrac></mrow><annotation encoding="application/x-tex">z_i=\frac{y_i-\theta_0}{\sqrt{V(Y|\theta_0)}}</annotation></semantics></math>
for site
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>
is the KRI metric calculated for site
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\theta_0</annotation></semantics></math>
is the overall mean,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msqrt><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt><annotation encoding="application/x-tex">\sqrt{V(Y|\theta_0)}</annotation></semantics></math>
is the measurement of variance.</p>
<p>For binary outcome,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt><mo>=</mo><msqrt><mfrac><mrow><mover><mi>p</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mover><mi>p</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msub><mi>n</mi><mi>i</mi></msub></mfrac></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{V(Y|\theta_0)}=\sqrt{\frac{\hat{p}(1-\hat{p})}{n_i}}</annotation></semantics></math>.</p>
<p>For rate outcome,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt><mo>=</mo><msqrt><mfrac><mover><mi>λ</mi><mo accent="true">̂</mo></mover><msub><mi>T</mi><mi>i</mi></msub></mfrac></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{V(Y|\theta_0)}=\sqrt{\frac{\hat{\lambda}}{T_i}}</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="over-dispersion-adjustment">Over-dispersion adjustment<a class="anchor" aria-label="anchor" href="#over-dispersion-adjustment"></a>
</h4>
<p>The standard normal approximation method described above assumes the
null distribution fully expresses the variability of the sites
in-control, but in many situations this assumption will not hold. In the
situation that there is a presence of greater variability than expected,
majority of the sites will fall outside the specified limits, leading to
a double of the appropriateness of the constructed limits.</p>
<p>A way of handling this issue is to allow over-dispersion in the
normal approximation. A multiplicative over-dispersion adjustment was
implemented in our approach.</p>
<p>Suppose a sample of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
units are to be <strong>in-control</strong>, the over-dispersion factor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
can be estimated as the mean squared z-scores, i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>ϕ</mi><mo accent="true">̂</mo></mover><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msubsup><mi>z</mi><mi>i</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\hat\phi = \frac{1}{m}\sum_{i=1}^m z_i^2</annotation></semantics></math>.
For binary outcome, the over-dispersion adjusted variance is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>ϕ</mi><mo>,</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>ϕ</mi><mfrac><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msub><mi>n</mi><mi>i</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">V'(Y_i|\phi, p)=\phi\frac{{p}(1-p)}{n_i}</annotation></semantics></math>.
For rate outcome, the over-dispersion adjusted variance is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>ϕ</mi><mo>,</mo><mi>λ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>ϕ</mi><mfrac><mi>λ</mi><msub><mi>T</mi><mi>i</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">V'(Y_i|\phi, \lambda)=\phi\frac{\lambda}{T_i}</annotation></semantics></math>.
Therefore, after the over-dispersion adjustment, the adjusted z-scores
for site
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><msub><mover><mi>p</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>−</mo><mover><mi>p</mi><mo accent="true">̂</mo></mover></mrow><msqrt><mrow><mover><mi>ϕ</mi><mo accent="true">̂</mo></mover><mfrac><mrow><mover><mi>p</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mover><mi>p</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msub><mi>n</mi><mi>i</mi></msub></mfrac></mrow></msqrt></mfrac></mrow><annotation encoding="application/x-tex">z_i = \frac{\hat{p}_i - \hat{p}}{\sqrt{\hat\phi \frac{{\hat{p}}(1-\hat{p})}{n_i}}}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><msub><mover><mi>λ</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>−</mo><mover><mi>λ</mi><mo accent="true">̂</mo></mover></mrow><msqrt><mrow><mover><mi>ϕ</mi><mo accent="true">̂</mo></mover><mfrac><mover><mi>λ</mi><mo accent="true">̂</mo></mover><msub><mi>T</mi><mi>i</mi></msub></mfrac></mrow></msqrt></mfrac></mrow><annotation encoding="application/x-tex">z_i = \frac{\hat{\lambda}_i - \hat{\lambda}}{\sqrt{\hat\phi \frac{\hat\lambda}{T_i}}}</annotation></semantics></math>,
respectively.</p>
<p>Reference: Spiegelhalter, David J. <strong>Funnel plots for comparing
institutional performance.</strong> <em>Statistics in medicine</em> 24.8
(2005): 1185-1202.</p>
</div>
<div class="section level4">
<h4 id="estimate-and-score">Estimate and Score<a class="anchor" aria-label="anchor" href="#estimate-and-score"></a>
</h4>
<p>The function <code><a href="../reference/Analyze_NormalApprox.html">Analyze_NormalApprox()</a></code> in
<a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> calculates adjusted z-score for each site as
discussed above. The adjusted z-scores are then used as a scoring metric
in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> to flag possible outliers using the thresholds
discussed below.</p>
</div>
<div class="section level4">
<h4 id="threshold">Threshold<a class="anchor" aria-label="anchor" href="#threshold"></a>
</h4>
<p>By default, sites with adjusted z-score exceeding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>±</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\pm 2</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>±</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\pm 3</annotation></semantics></math>
from the normal approximation analysis are flagged as amber or red,
respectively. The thresholds are set at common choices corresponding to
95.6% and 99.7% of the data around the mean in a standard normal
distribution. However, they are fully configurable in the package and
can be customized and specified in the {gsm} functions.</p>
</div>
<div class="section level4">
<h4 id="special-situations">Special Situations<a class="anchor" aria-label="anchor" href="#special-situations"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Results are not interpretable or it is not appropriate to apply the
asymptotic method: We don’t want to flag in certain situations when
results not interpretable or when it is not appropriate to apply the
asymptotic method due to the small sample sizes. The default threshold
for minimum denominator requirement is 30 days exposure or 3 patients at
the site level.</li>
</ol>
</div>
<div class="section level4">
<h4 id="recommendation">Recommendation<a class="anchor" aria-label="anchor" href="#recommendation"></a>
</h4>
<p>Normal approximation method can be used in all scenarios with binary
or rate KRIs.</p>
</div>
</div>
<div class="section level3">
<h3 id="the-identity-method">2. The Identity Method<a class="anchor" aria-label="anchor" href="#the-identity-method"></a>
</h3>
<p>Identity method simply uses the count of event in the numerator of
the KRI metric itself as the score. The thresholds for monitoring site
risk are set based on the actual counts.</p>
</div>
<div class="section level3">
<h3 id="the-fishers-exact-method">3. The Fisher’s Exact Method<a class="anchor" aria-label="anchor" href="#the-fishers-exact-method"></a>
</h3>
<div class="section level4">
<h4 id="introduction-1">Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"></a>
</h4>
<p>For the binary outcome KRIs, an optional method in {gsm} is
implemented with Fisher’s exact test.</p>
<p>Fisher’s exact test is a statistical significance test used in the
analysis of contingency tables when we have nominal variables and want
to find out if proportions for one variable are different among values
of the other variables.</p>
<p>In contrast to large-sample based asymptotic statistics which rely on
approximation, Fisher’s exact test can be applied when sample sizes are
small.</p>
<p>The function <code>Analyze_Fisher</code> in {gsm} utilizes
<code><a href="https://rdrr.io/r/stats/fisher.test.html" class="external-link">stats::fisher.test</a></code> to generate an estimate of odds ratio as
well as p-value using the Fisher’s exact test with site-level count
data. For each site, Fisher’s exact test is conducted by comparing to
all other sites combined in a 2×2 contingency table. The p-values are
then used as a scoring metric in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> to flag possible
outliers. The default in <code><a href="https://rdrr.io/r/stats/fisher.test.html" class="external-link">stats::fisher.test</a></code> uses a
two-sided test (equivalent to testing the null of OR = 1) and does not
compute p-values by Monte Carlo simulation unless
<code>simulate.p.value = TRUE</code>. Sites with p-values less than 0.05
from the Fisher’s exact test analysis are flagged by default. The
significance level was set at a common choice.</p>
</div>
<div class="section level4">
<h4 id="methods-1">Methods<a class="anchor" aria-label="anchor" href="#methods-1"></a>
</h4>
<p>For example, in a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math>
contingency table comparing a particular site to all other sites
combined, the two rows displaying the binary outcome are considered
repeated Bernoulli random samples with same probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">p=0.5</annotation></semantics></math>
of success or failure under the null. Given a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math>
contingency table,</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">Site1</th>
<th align="left">RestSites</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Yes</td>
<td align="left">a</td>
<td align="left">c</td>
</tr>
<tr class="even">
<td align="left">No</td>
<td align="left">b</td>
<td align="left">d</td>
</tr>
</tbody>
</table>
<p>Fisher (1922) showed that conditional on the margins of the table,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>
is distributed as a hypergeometric distribution with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">a+c</annotation></semantics></math>
draws from a population with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a+b</annotation></semantics></math>
successes and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>+</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">c+d</annotation></semantics></math>
failures. Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo>+</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">n=a+b+c+d</annotation></semantics></math>,
the probability of obtaining such set of values is given by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><mi>a</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mrow><mi>c</mi><mo>+</mo><mi>d</mi></mrow><mi>c</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mi>n</mi><mrow><mi>a</mi><mo>+</mo><mi>c</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><mi>b</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mrow><mi>c</mi><mo>+</mo><mi>d</mi></mrow><mi>d</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mi>n</mi><mrow><mi>b</mi><mo>+</mo><mi>d</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>!</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>c</mi><mo>+</mo><mi>d</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>!</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>+</mo><mi>c</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>!</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>+</mo><mi>d</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>!</mi></mrow><mrow><mi>a</mi><mi>!</mi><mi>b</mi><mi>!</mi><mi>c</mi><mi>!</mi><mi>d</mi><mi>!</mi><mi>n</mi><mi>!</mi></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
p=\frac{{{a+b} \choose a} {{c+d} \choose c}}{{n \choose {a+c}}}=\frac{{{a+b} \choose b} {{c+d} \choose d}}{{n \choose {b+d}}}=\frac{(a+b)!(c+d)!(a+c)!(b+d)!}{a! b! c! d! n!}.
</annotation></semantics></math></p>
</div>
<div class="section level4">
<h4 id="estimate-and-score-1">Estimate and Score<a class="anchor" aria-label="anchor" href="#estimate-and-score-1"></a>
</h4>
<p>The function <code><a href="../reference/Analyze_Fisher.html">Analyze_Fisher()</a></code> in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a>
utilizes <code><a href="https://rdrr.io/r/stats/fisher.test.html" class="external-link">stats::fisher.test()</a></code> to generate an estimate of
odds ratio as well as p-value using the Fisher’s exact test with
site-level count data. For each site, Fisher’s exact test is conducted
by comparing to all other sites combined in a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math>
contingency table. The p-values are then used as a scoring metric in
<a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> to flag possible outliers using the thresholds
discussed below. The default in <code><a href="https://rdrr.io/r/stats/fisher.test.html" class="external-link">stats::fisher.test()</a></code> uses
two-sided test (equivalent to testing the null: OR=1) and not to compute
p-values by Monte Carlo simulation unless
<code>simulate.p.value = TRUE</code> is specified.</p>
</div>
<div class="section level4">
<h4 id="threshold-1">Threshold<a class="anchor" aria-label="anchor" href="#threshold-1"></a>
</h4>
<p>By default, sites with p-values less than 0.05 or 0.01 from the
Fisher’s exact test analysis are flagged as amber or red, respectively.
The thresholds are set based on empirical p-value approach, where we use
the distribution of the p-values to find the best separation of the data
to identify sites at risk. The default thresholds are set at common
choices of significance levels. However, they are fully configurable in
the package and can be customized and specified in the {gsm}
functions.</p>
</div>
<div class="section level4">
<h4 id="the-fishers-exact-test-assumptions">The Fisher’s exact test assumptions<a class="anchor" aria-label="anchor" href="#the-fishers-exact-test-assumptions"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>The row totals and the column totals are both fixed by
design.</p></li>
<li><p>The samples are mutually exclusive and mutually
independent.</p></li>
</ol>
<p>The assumptions can be assessed by the knowledge of data collected.
No assumption check is necessary.</p>
</div>
<div class="section level4">
<h4 id="special-situations-1">Special situations<a class="anchor" aria-label="anchor" href="#special-situations-1"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>Functionally: where we don’t have required input to run Fishers:
p-value will be set <code>NA</code>.</p></li>
<li><p>Results not interpretable: we don’t want to flag in certain
situations when results not interpretable due to small sample sizes. The
default threshold for minimum denominator requirement is 3 patients at
the site level.</p></li>
<li><p>An observed zero cell is not an issue when using Fisher’s exact
test, however, when the expected cell is zero, it means either the
marginal is zero (meaningless) or there are structural zeros (need to
consider zero-inflated issue: West, L. and Hankin, R. (2008), “Exact
Tests for Two-Way Contingency Tables with Structural Zeros,” Journal of
Statistical Software, 28(11), 1–19).</p></li>
</ol>
</div>
<div class="section level4">
<h4 id="constraints">constraints<a class="anchor" aria-label="anchor" href="#constraints"></a>
</h4>
<p>For small samples, Fisher’s exact test is highly discrete. Fisher’s
exact test is often considered to be more conservative. This may due to
the use a discrete statistic with fixed significance levels (<a href="https://en.wikipedia.org/wiki/Fisher%27s_exact_test#Controversies" class="external-link">FET
Controversies Wiki</a>).</p>
<p>Although in practice, Fisher’s exact test is usually used when sample
sizes are small (e.g., n&lt;5), it is valid for all sample sizes.
However, when sample sizes are large, the computation of the exact test
evaluating the hypergeometric probability function given the marginal
can take a very long time.</p>
</div>
<div class="section level4">
<h4 id="recommendation-1">Recommendation<a class="anchor" aria-label="anchor" href="#recommendation-1"></a>
</h4>
<p>Fisher’s exact test can be used in all scenarios with binary
KRIs.</p>
</div>
</div>
<div class="section level3">
<h3 id="the-poisson-regression-method">4. The Poisson Regression Method<a class="anchor" aria-label="anchor" href="#the-poisson-regression-method"></a>
</h3>
<div class="section level4">
<h4 id="introduction-2">Introduction<a class="anchor" aria-label="anchor" href="#introduction-2"></a>
</h4>
<p>For the rate outcome KRIs, an optional method in {gsm} is implemented
with Poisson regression.</p>
<p>The Poisson distribution is often used to model count data. If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
is the number of counts following Poisson distribution, the probability
mass function is given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><msup><mi>μ</mi><mi>y</mi></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>μ</mi></mrow></msup></mrow><mrow><mi>y</mi><mi>!</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
f(y)=\frac{\mu^ye^{-\mu}}{y!}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the average number of counts and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>V</mi><mi>a</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>μ</mi></mrow><annotation encoding="application/x-tex">E(Y)=Var(Y)=\mu</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="methods-2">Methods<a class="anchor" aria-label="anchor" href="#methods-2"></a>
</h4>
<p>This method fits a Poisson model to site-level data and then
calculates deviance residuals for each site. The Poisson model is run
using standard methods in the <code>stats</code> package by fitting a
<code>glm</code> model with family set to <code>poisson</code> using a
“log” link. Site-level deviance residuals are calculated using
<code>resid</code> from <code><a href="https://rdrr.io/r/stats/predict.glm.html" class="external-link">stats::predict.glm</a></code> via
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">broom::augment</a></code>.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mn>1</mn></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>Y</mi><mi>N</mi></msub></mrow><annotation encoding="application/x-tex">Y_1, ..., Y_N</annotation></semantics></math>
be independent random variables with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>∼</mo><mi>P</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y_i \sim Poisson(\mu_i)</annotation></semantics></math>
denoting the number of events observed from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>i</mi></msub><annotation encoding="application/x-tex">n_i</annotation></semantics></math>
for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
observation following Poisson distribution. Then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>μ</mi><mi>i</mi></msub><mo>=</mo><msub><mi>n</mi><mi>i</mi></msub><msup><mi>e</mi><mrow><msub><mi>x</mi><mi>i</mi></msub><mi>β</mi></mrow></msup></mrow><annotation encoding="application/x-tex">E(Y_i)=\mu_i=n_ie^{x_i\beta}</annotation></semantics></math>.
Thus,the log-linear generalized linear model (Poisson regression) is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><msub><mi>μ</mi><mi>i</mi></msub><mo>=</mo><mo>log</mo><msub><mi>n</mi><mi>i</mi></msub><mo>+</mo><msub><mi>x</mi><mi>i</mi></msub><mi>β</mi><mspace width="1.0em"></mspace><msub><mi>Y</mi><mi>i</mi></msub><mo>∼</mo><mi>P</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\log{\mu_i}=\log{n_i}+x_i\beta \quad Y_i \sim Poisson(\mu_i)
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\log{n_i}</annotation></semantics></math>
is an offset term.</p>
</div>
<div class="section level4">
<h4 id="estimate-and-score-2">Estimate and Score<a class="anchor" aria-label="anchor" href="#estimate-and-score-2"></a>
</h4>
<p>The function <code><a href="../reference/Analyze_Poisson.html">Analyze_Poisson()</a></code> in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a>
utilizes <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> to generate an estimate of fitted
values as well as deviance residual with site-level count data. The
p-values are then used as a scoring metric in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> to flag
possible outliers using the thresholds discussed below.</p>
</div>
<div class="section level4">
<h4 id="threshold-2">Threshold<a class="anchor" aria-label="anchor" href="#threshold-2"></a>
</h4>
<p>By default, sites with deviance residuals exceeding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>±</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">\pm 5</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>±</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">\pm 7</annotation></semantics></math>
from the Poisson analysis are flagged as amber or red, respectively. The
thresholds are set based on empirical approach, where we use the
distribution of the deviance residuals to find the best separation of
the data to identify sites at risk. The default thresholds are set at
empirical values based on pilot studies’ data. However, they are fully
configurable in the package and can be customized and specified in the
{gsm} functions.</p>
</div>
<div class="section level4">
<h4 id="special-situations-2">Special Situations<a class="anchor" aria-label="anchor" href="#special-situations-2"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Results are not interpretable or it is not appropriate to apply the
Poisson method: We don’t want to flag in certain situations when results
not interpretable or when it is not appropriate to apply the Poisson
method due to the small sample sizes. The default threshold for minimum
denominator requirement is 30 days exposure at the site level.</li>
</ol>
<!-- TODO. Discuss hard rules on STOP-IF-NOT situations -->
</div>
<div class="section level4">
<h4 id="poisson-regression-assumptions">Poisson regression assumptions<a class="anchor" aria-label="anchor" href="#poisson-regression-assumptions"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p><strong>Independence</strong> The responses
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>
are independent of each other.</p></li>
<li><p><strong>Count data</strong> The responses
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>
are non-negative integer (counts).</p></li>
<li><p><strong>Poisson response</strong> Each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_i</annotation></semantics></math>
follows the Poisson distribution as noted above with mean and variance
equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>.</p></li>
<li><p><strong>Linearity</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><msub><mi>μ</mi><mi>i</mi></msub><mo>=</mo><mo>log</mo><msub><mi>n</mi><mi>i</mi></msub><mo>+</mo><msub><mi>x</mi><mi>i</mi></msub><mi>β</mi></mrow><annotation encoding="application/x-tex">\log{\mu_i}=\log{n_i}+x_i\beta</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math>
are independent predictors.</p></li>
</ol>
</div>
<div class="section level4">
<h4 id="assumption-checks-constraints-and-model-diagnosis">Assumption checks, constraints and model diagnosis<a class="anchor" aria-label="anchor" href="#assumption-checks-constraints-and-model-diagnosis"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>The assumptions on independence and counted data can be assessed
by the knowledge of data collected.</p></li>
<li><p>The assumptions on Poisson response can be checked by plotting
histogram of the data and comparing empirical mean and variance
stratified by the explanatory variable(s). If there is evidence that the
assumption of mean=variance is violated, oftentimes we observe
variance&gt;mean. This is called overdispersion. In this case, negative
binomial distribution provides an alternative where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>ϕ</mi><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Var(Y_i)=\phi E(Y_i)</annotation></semantics></math>.</p></li>
<li><p>Diagnosis: Goodness of fit test (chi-squared) and deviance
residuals. Residuals vs fitted plot. Q-Q plot.</p></li>
<li><p>Other considerations: Structural zeros may happen in contrast to
random zeros due to sampling from poisson distribution. In this case, a
mixture model (zero-inflated Poisson model) may be required.</p></li>
</ol>
</div>
<div class="section level4">
<h4 id="recommendation-2">Recommendation<a class="anchor" aria-label="anchor" href="#recommendation-2"></a>
</h4>
<p>Use this method when Poisson assumptions hold.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by George Wu, Jeremy Wildfire, Matt Roumaya, Spencer Childress, Laura Maxwell, Jacob Anderson, Jon Harmon, Zelos <a href="mailto:zelos.zhu@atorusresearch.com" class="email">zelos.zhu@atorusresearch.com</a> Zhu, Nathan Kosiba, Douglas Sanders, Li Ge, Zhongkai Wang, Colleen McLaughlin, Chelsea Dickens, Maya Gans.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
