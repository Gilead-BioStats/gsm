<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>gsm Extensions • gsm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="gsm Extensions">
<link href="pkgdown/extra.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Workflows</h6></li>
    <li><a class="dropdown-item" href="../articles/DataModel.html">Data Model</a></li>
    <li><a class="dropdown-item" href="../articles/Cookbook.html">Cookbook</a></li>
    <li><a class="dropdown-item" href="../articles/DataAnalysis.html">Step-by-Step Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/DataReporting.html">Step-by-Step Reporting Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/gsmExtensions.html">gsm Extensions</a></li>
    <li><a class="dropdown-item" href="../articles/KRIMethod.html">KRI Method</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quality</h6></li>
    <li><a class="dropdown-item" href="../articles/QualificationWorkflow.html">Qualification Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/Qualification.html">Qualification Report for the {gsm} R Package</a></li>
    <li><a class="dropdown-item" href="../articles/ContributorGuidelines.html">Contributor Guidelines</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-sample-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Sample Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-sample-reports">
<li><a class="dropdown-item" href="../report_kri_site.html">Site Report</a></li>
    <li><a class="dropdown-item" href="../report_kri_country.html">Country Report</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Gilead-BioStats/gsm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>gsm Extensions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Gilead-BioStats/gsm/blob/main/vignettes/gsmExtensions.Rmd" class="external-link"><code>vignettes/gsmExtensions.Rmd</code></a></small>
      <div class="d-none name"><code>gsmExtensions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette describes how to extend <code>gsm</code> by creating
new “modules”, including metrics, reports and shiny apps that can be run
using the standard <code>gsm</code> pipeline described in these
vignettes (<code><a href="../articles/DataAnalysis.html">vignette("DataAnalysis")</a></code>,
<code><a href="../articles/DataReporting.html">vignette("DataReporting")</a></code>). As shown in the
<code><a href="../articles/DataAnalysis.html">vignette("DataAnalysis")</a></code>, the <code>gsm</code> data
pipeline can be used to capture a monitoring ‘snapshot’ for a study that
includes a variety of “modules” including <a href="https://github.com/Gilead-BioStats/gsm/tree/dev/inst/workflow/metrics/kri0001.yaml" class="external-link">metrics</a>
and <a href="https://github.com/Gilead-BioStats/gsm/blob/dev/inst/workflow/reports/report_kri_site.yaml" class="external-link">reports</a>.
Some core modules are included in the <code>gsm</code> package, while
others can be added as extensions.</p>
<p>This vignette provide detailed specifications for creating new
modules, a description of the directory structure for the yaml workflows
that comprise a module pipeline, and links to resources that can be used
to configure study-level gsm pipelines that utilize these
<code>gsm</code> extensions.</p>
</div>
<div class="section level2">
<h2 id="module-configuration">Module Configuration<a class="anchor" aria-label="anchor" href="#module-configuration"></a>
</h2>
<p><code>gsm</code> modules will typically be part of an R package and
have a YAML configuration file - <code>{module_name}.yaml</code> - saved
under <code>\inst\workflow\4_modules</code>. Module config files include
3 key properties:</p>
<ul>
<li>
<code>meta</code>: (required) Report metadata used for centralized
library and fields referenced in <code>steps</code> section of
workflow.</li>
<li>
<code>spec</code>: (required) Data table requirement for the report.
Typically from <code>Mapped_*</code> or <code>Reporting_*</code>
data.</li>
<li>
<code>steps</code>: (required) Functions to produce the reporting
output from <code>Mapped_*</code> and/or <code>Reporting_*</code> data
to final output (<code>html</code>, <code>csv</code> or
<code>shinyApp</code>).</li>
</ul>
<p>Detailed specifications for each of these sections are provided
below.</p>
<div class="section level3">
<h3 id="example-module-configuration-yamls">Example Module Configuration YAMLs<a class="anchor" aria-label="anchor" href="#example-module-configuration-yamls"></a>
</h3>
<p>Here are links to several sample module configuration files:</p>
<ul>
<li>
<a href="https://github.com/Gilead-BioStats/gsm/tree/dev/inst/workflow/metrics" class="external-link">12
Standard gsm KRIs</a> (e.g. <a href="https://github.com/Gilead-BioStats/gsm/tree/dev/inst/workflow/metrics/kri0001.yaml" class="external-link">Adverse
Event KRI Metric</a>)</li>
<li>
<a href="https://github.com/Gilead-BioStats/gsm/blob/dev/inst/workflow/reports/report_kri_site.yaml" class="external-link">Site-</a>
and <a href="https://github.com/Gilead-BioStats/gsm/blob/dev/inst/workflow/reports/report_kri_country.yaml" class="external-link">Country-level
KRI Report</a>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="meta-specification">
<code>meta</code> Specification<a class="anchor" aria-label="anchor" href="#meta-specification"></a>
</h3>
<p>The <code>meta</code> section of a workflow YAML provides key
metadata describing the module. It must include the following
fields:</p>
<ul>
<li>
<code>Name</code>: Name of the reporting output.</li>
<li>
<code>Type</code>: “Report”, “Metric” or “App”</li>
<li>
<code>ID</code>: The unique ID for the module. This should be the
same as the workflow file name, without extension.</li>
<li>
<code>Description</code>: A one-line description of the module
specified in the workflow.</li>
<li>
<code>Priority</code>: <em>optional</em> A number specifying the
priority of the workflow within the directory, with lower numbers having
higher priority, and running first. This is used when workflows within
the same directory require outputs from other workflows, and thus need
to be run in a particular order. If missing, will be set to 0 to run
first.</li>
<li>
<code>Details</code>: <em>optional</em> A more detailed description
of the module specified in the workflow.</li>
<li>
<code>Repo</code>: Package repo and version. Should be compatible
with the <code>repo</code> parameter in
<code><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">remotes::install_github()</a></code>.</li>
<li>
<code>Status</code>: The validation status of the reporting output.
Valid values:
<ul>
<li>
<code>Qualified</code>: Output has been qualified via our
qualification process specified <a href="https://gilead-biostats.github.io/gsm/articles/QualificationWorkflow.html">here</a>.</li>
<li>
<code>Pilot</code>: Output is being used by pilot studies and is
maintained in a package repository.</li>
<li>
<code>Prototype</code>: Output is created using custom scripts on an
ad-hoc basis.</li>
</ul>
</li>
</ul>
<p>Additional <code>meta</code> header required fields for
<strong>Modules</strong>:</p>
<ul>
<li>
<code>Permission</code>: Level of permissions for viewing that match
the <code>Users</code> argument in the Study Configuration file. Common
values: <code>Admin</code>, <code>Users</code>.</li>
<li>
<code>Output</code>: The output of the workflow, including format.
Each workflow should only produce a single reporting output.</li>
<li>
<code>ExampleURL</code>: Location of a sample report. For html
reports, this is typically a page on the pkgdown site (ending with
“/{ModuleID}.html”), or a sample app deployed on <a href="https://shinyapps.io" class="external-link">shinyapps.io</a>.</li>
</ul>
<p>Additional <code>meta</code> header required fields for
<a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> <strong>metrics</strong>:</p>
<ul>
<li>
<code>GroupLevel</code>: The level at which the metric is
calculated. Common values: <code>Site</code>, <code>Country</code>.</li>
<li>
<code>Abbreviation</code>: Abbreviation of the metric.</li>
<li>
<code>Metric</code>: Full name of the metric.</li>
<li>
<code>Numerator</code>: The numerator of the metric.</li>
<li>
<code>Denominator</code>: The denominator of the metric.</li>
<li>
<code>AnalysisType</code>: The analysis type. Common values:
<code>rate</code>, <code>binary</code>
</li>
<li>
<code>Model</code>: The model used to calculate the metric. Common
values: <code>Normal Approximation</code>, <code>Exact</code>,
<code>Bayesian</code>.</li>
<li>
<code>Score</code>: The score used to calculate the metric. Common
values: <code>Z-Score</code>, <code>Adjusted Z-Score</code>,
<code>P-Value</code>.</li>
<li>
<code>Threshold</code>: The thresholds needed to flag.</li>
</ul>
<div class="section level4">
<h4 id="meta-example">
<code>meta</code> example<a class="anchor" aria-label="anchor" href="#meta-example"></a>
</h4>
<p>A simple <code>meta</code> section for a report might look like
this:</p>
<pre><code>  File: report_example.yaml
  ID: example_report
  Name: An example report
  Description: A report that is an example
  Type: Report
  Repo: gsm.example v1.0.0
  Status: Qualified
  Permission: Users
  Outputs: An html report
  ExampleURL: https://gilead-biostats.github.io/gsm.example/example_report.html</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="spec-specification">
<code>spec</code> Specification<a class="anchor" aria-label="anchor" href="#spec-specification"></a>
</h3>
<p>The <code>spec</code> section of the workflow YAML specifies the data
requirements for the workflow, including the data tables that are
required and the columns that are needed from each table. The
<code>gsm</code> data pipeline is designed to be highly customizable,
but for the purposes of this vignette, we will assume usage of the
standard <code>gsm</code> data model described in
<code><a href="../articles/DataModel.html">vignette("DataModel")</a></code>. For this standard use case, modules
will pull primarily from the “Mapped” and “Reporting” data layers.</p>
<p>The <code>spec</code> section of the workflow YAML is formatted as a
list of data tables, with each table containing a list of columns.
Finally, each column contains the following parameters:</p>
<ul>
<li>
<code>required</code>: Boolean field specifying whether this column
is required for the workflow to run, or optional/recommended for
inclusion for user experience or augmented information. This parameter
is required and must be included for all columns.</li>
<li>
<code>type</code>: Character field describing the data type of the
column. Use a <code>mode</code> as defined by R. This parameter is
optional.</li>
</ul>
<div class="section level4">
<h4 id="spec-example-metric-module">
<code>spec</code> example: Metric Module<a class="anchor" aria-label="anchor" href="#spec-example-metric-module"></a>
</h4>
<p>Metric <code>spec</code>s are typically pulled from the
<code>mapped</code> data layer. For example, the <code>spec</code>
section for the <a href="https://github.com/Gilead-BioStats/gsm/tree/dev/inst/workflow/metrics/kri0001.yaml" class="external-link">AE
KRI metric</a> is:</p>
<pre><code><span><span class="va">spec</span><span class="op">:</span></span>
<span>  <span class="va">Mapped_AE</span><span class="op">:</span></span>
<span>    <span class="va">subjid</span><span class="op">:</span></span>
<span>      <span class="va">required</span><span class="op">:</span> <span class="va">true</span></span>
<span>      <span class="va">type</span><span class="op">:</span> <span class="va">character</span></span>
<span>  <span class="va">Mapped_ENROLL</span><span class="op">:</span></span>
<span>    <span class="va">subjid</span><span class="op">:</span></span>
<span>      <span class="va">required</span><span class="op">:</span> <span class="va">true</span></span>
<span>      <span class="va">type</span><span class="op">:</span> <span class="va">character</span></span>
<span>    <span class="va">invid</span><span class="op">:</span></span>
<span>      <span class="va">required</span><span class="op">:</span> <span class="va">true</span></span>
<span>      <span class="va">type</span><span class="op">:</span> <span class="va">character</span></span>
<span>    <span class="va">timeonstudy</span><span class="op">:</span></span>
<span>      <span class="va">required</span><span class="op">:</span> <span class="va">true</span></span>
<span>      <span class="va">type</span><span class="op">:</span> <span class="va">integer</span></span></code></pre>
<p>So, in summary, the AE KRI metric requires two data tables,
<code>Mapped_AE</code> and <code>Mapped_ENROLL</code>, both of which are
from the mapped data layer. The <code>Mapped_AE</code> table must have a
character Subject ID column called <code>subjid</code> while
<code>Mapped_ENROLL</code> must have character Subject ID
(<code>subjid</code>) and Investigator ID (<code>invid</code>) columns
and a numeric <code>timeonstudy</code> column. All columns are required
for this metric. Note that other columns may be present in these tables
(perhaps due to a <code>spec</code> from a differently module), but only
the columns listed in the <code>spec</code> section are required for the
metric to run.</p>
</div>
<div class="section level4">
<h4 id="spec-examples-report-module">
<code>spec</code> examples: Report Module<a class="anchor" aria-label="anchor" href="#spec-examples-report-module"></a>
</h4>
<p>Report modules most often pull data from the <code>Reporting</code>
data layer. For example, the <a href="https://github.com/Gilead-BioStats/gsm/blob/dev/inst/workflow/reports/report_kri_site.yaml" class="external-link">Site-level
KRI report</a> has the following <code>spec</code>:</p>
<pre><code>spec:
  Reporting_Results: 
    _all:
      required: true
  Reporting_Groups:
    _all:
      required: false
  Reporting_Metrics:
    _all:
      required: false
  Reporting_Bounds:
    _all: 
      require: false</code></pre>
<p>Note that the <code>_all</code> key word is used to specify that all
standard columns from the <code>Reporting_Results</code> data table are
expected and that the table required - without it, the report can’t run.
The other <code>Reporting</code> tables are used to enhance the report,
but are not required.</p>
<p>The <code>Mapped</code> data layer is also available for use in
reports and apps. Most typically, mapped data is used to drill down from
high-level metric findings (e.g. “Site 5 has an elevated AE rate
relative to other studies”) to site- or participant- level details
(e.g. “Participant 00016 from Site 5 had 5 AEs and 3 SAEs reported in
the last 3 months.”). For example, the <a href="">Deep Dive app</a>
includes both Reporting and Mapped data in its <code>spec</code>. Here
is a representative excerpt from the <code>spec</code>:</p>
<pre><code>spec:
  Reporting_Results: 
    _all:
      required: true
  Mapped_AE:
    subjid:
      required: false
      type: character
    aeterm:
      required: false
      type: character 
    aesev: 
      required: false
      type: character
    ...</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="steps-specification">
<code>steps</code> Specification<a class="anchor" aria-label="anchor" href="#steps-specification"></a>
</h3>
<p>Finally, each module yaml configuration file should have a
<code>steps</code> property that describes in detail how the module is
run. The <code>steps</code> section is a list of functions that are run
in sequence to produce the final output. Each item in <code>steps</code>
has the following properties:</p>
<ul>
<li>
<code>name</code>: The name of the function to be run. This must be
a function that is available in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> package or in a
package that is listed in the <code>repo</code> section of the
<code>meta</code> header.</li>
<li>
<code>output</code>: The name of the output of the function. This is
the name of the data table that is created by the function.</li>
<li>
<code>params</code>: A list of parameters that are passed to the
function. The parameters are specific to the function that is being run.
See below for more details on how to specify parameters for each
function.</li>
</ul>
<p><strong>Note</strong>: It is important to note that the default
behavior of the <code><a href="../reference/RunWorkflow.html">RunWorkflow()</a></code> and
<code><a href="../reference/RunWorkflows.html">RunWorkflows()</a></code> functions is to return the <em>last</em>
output in the steps section of the workflow. therefore, each yaml file-
regardless of which directory it is in- should only produce one output,
whether that be a data table, list, html output, deployed shiny app, or
any other object needed to produce the module output.</p>
<p>The <code>steps</code> is the most complex part of the module
configuration and will vary greatly depending on the module type and the
specific requirements of the module. <code>gsm</code> provides several
functions that allow for module yaml files to be run in a standard way.
See <code>?gsm::RunWorkflow()</code> for more details.</p>
<div class="section level4">
<h4 id="stepsparams-specification">
<code>steps[]$params</code> Specification<a class="anchor" aria-label="anchor" href="#stepsparams-specification"></a>
</h4>
<p>After processing the YAML <code>meta</code> and <code>spec</code>
sections, <code><a href="../reference/RunWorkflow.html">gsm::RunWorkflow()</a></code> calls
<code><a href="../reference/RunStep.html">gsm::RunStep()</a></code> for each step in the <code>steps</code>
section of the YAML. The <code>params</code> section of each step is
passed to <code><a href="../reference/RunStep.html">RunStep()</a></code> as a list of parameters along with a
copy of the metadata header (<code>lMeta</code>) and any data
(<code>lData</code>). <code><a href="../reference/RunStep.html">RunStep()</a></code> then parses the list of
<code>params</code> by passing data from <code>lMeta</code> and
<code>lData</code> when appropriate - see <code><a href="../reference/RunStep.html">?RunStep</a></code> for a
detailed of how parameter values are populated. Finally, the parsed
parameters are passed to the function specified in the <code>name</code>
field of the step.</p>
</div>
<div class="section level4">
<h4 id="steps-examples">
<code>steps</code> examples<a class="anchor" aria-label="anchor" href="#steps-examples"></a>
</h4>
<div class="section level5">
<h5 id="metric-steps-example">
<code>Metric</code> steps example<a class="anchor" aria-label="anchor" href="#metric-steps-example"></a>
</h5>
<p>In the example below, the steps to produce the AE analysis output is
specified. Here, <code>Threshold</code>, <code>GroupLevel</code>,
<code>Type</code> and <code>nMinDenominator</code> are specified in the
<code>meta</code> section of the workflow, and would be access via the
<code>paramVal</code> process discussed above. As a default, the output
of these steps as run with <code><a href="../reference/RunWorkflows.html">RunWorkflows()</a></code> would be a list
of data tables, as specified in the final <code>list</code> step of the
workflow.</p>
<pre><code><span><span class="va">steps</span><span class="op">:</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">ParseThreshold</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">vThreshold</span></span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">strThreshold</span><span class="op">:</span> <span class="va">Threshold</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">Input_Rate</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">Analysis_Input</span></span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">dfSubjects</span><span class="op">:</span> <span class="va">Mapped_SUBJ</span></span>
<span>      <span class="va">dfNumerator</span><span class="op">:</span> <span class="va">Mapped_AE</span></span>
<span>      <span class="va">dfDenominator</span><span class="op">:</span> <span class="va">Mapped_SUBJ</span></span>
<span>      <span class="va">strSubjectCol</span><span class="op">:</span> <span class="va">subjid</span></span>
<span>      <span class="va">strGroupCol</span><span class="op">:</span> <span class="va">invid</span></span>
<span>      <span class="va">strGroupLevel</span><span class="op">:</span> <span class="va">GroupLevel</span></span>
<span>      <span class="va">strNumeratorMethod</span><span class="op">:</span> <span class="va">Count</span></span>
<span>      <span class="va">strDenominatorMethod</span><span class="op">:</span> <span class="va">Sum</span></span>
<span>      <span class="va">strDenominatorCol</span><span class="op">:</span> <span class="va">timeonstudy</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">Transform_Rate</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">Analysis_Transformed</span></span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">dfInput</span><span class="op">:</span> <span class="va">Analysis_Input</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">Analyze_NormalApprox</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">Analysis_Analyzed</span></span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">dfTransformed</span><span class="op">:</span> <span class="va">Analysis_Transformed</span></span>
<span>      <span class="va">strType</span><span class="op">:</span> <span class="va">AnalysisType</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">Flag_NormalApprox</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">Analysis_Flagged</span></span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">dfAnalyzed</span><span class="op">:</span> <span class="va">Analysis_Analyzed</span></span>
<span>      <span class="va">vThreshold</span><span class="op">:</span> <span class="va">vThreshold</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">Summarize</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">Analysis_Summary</span></span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">dfFlagged</span><span class="op">:</span> <span class="va">Analysis_Flagged</span></span>
<span>      <span class="va">nMinDenominator</span><span class="op">:</span> <span class="va">nMinDenominator</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">list</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">kri0001</span></span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">id</span><span class="op">:</span> <span class="va">ID</span></span>
<span>      <span class="va">input</span><span class="op">:</span> <span class="va">Analysis_Input</span></span>
<span>      <span class="va">transformed</span><span class="op">:</span> <span class="va">Analysis_Transformed</span></span>
<span>      <span class="va">analyzed</span><span class="op">:</span> <span class="va">Analysis_Analyzed</span></span>
<span>      <span class="va">flagged</span><span class="op">:</span> <span class="va">Analysis_Flagged</span></span>
<span>      <span class="va">summary</span><span class="op">:</span> <span class="va">Analysis_Summary</span></span></code></pre>
</div>
<div class="section level5">
<h5 id="report-steps-example">
<code>Report</code> steps example<a class="anchor" aria-label="anchor" href="#report-steps-example"></a>
</h5>
<p>In this example, the steps to produce a site-level KRI report is
displayed. Here, the only inputs are the <code>Reporting_*</code> data,
which goes through a simple filtering process via <code>RunQuery</code>
before the Charts and Report are created in the following two
functions</p>
<pre><code><span><span class="va">steps</span><span class="op">:</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">RunQuery</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">Reporting_Results_Site</span></span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">df</span><span class="op">:</span> <span class="va">Reporting_Results</span></span>
<span>      <span class="va">strQuery</span><span class="op">:</span> <span class="st">"SELECT * FROM df WHERE GroupLevel == 'Site'"</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">RunQuery</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">Reporting_Metrics_Site</span></span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">df</span><span class="op">:</span> <span class="va">Reporting_Metrics</span></span>
<span>      <span class="va">strQuery</span><span class="op">:</span> <span class="st">"SELECT * FROM df WHERE GroupLevel == 'Site'"</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">MakeCharts</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">lCharts_Site</span></span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">dfResults</span><span class="op">:</span> <span class="va">Reporting_Results_Site</span></span>
<span>      <span class="va">dfGroups</span><span class="op">:</span> <span class="va">Reporting_Groups</span></span>
<span>      <span class="va">dfBounds</span><span class="op">:</span> <span class="va">Reporting_Bounds</span></span>
<span>      <span class="va">dfMetrics</span><span class="op">:</span> <span class="va">Reporting_Metrics_Site</span></span>
<span>  <span class="op">-</span> <span class="va">name</span><span class="op">:</span> <span class="va">Report_KRI</span></span>
<span>    <span class="va">output</span><span class="op">:</span> <span class="va">lReport</span> </span>
<span>    <span class="va">params</span><span class="op">:</span></span>
<span>      <span class="va">lCharts</span><span class="op">:</span> <span class="va">lCharts_Site</span></span>
<span>      <span class="va">dfResults</span><span class="op">:</span> <span class="va">Reporting_Results_Site</span></span>
<span>      <span class="va">dfGroups</span><span class="op">:</span> <span class="va">Reporting_Groups</span></span>
<span>      <span class="va">dfMetrics</span><span class="op">:</span> <span class="va">Reporting_Metrics_Site</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="directory-structure-for-workflows">Directory Structure for Workflows<a class="anchor" aria-label="anchor" href="#directory-structure-for-workflows"></a>
</h2>
<p>Each extension that produces report(s) will have a
<code>workflow</code> directory in the <code>inst</code> of the package
that follows a standard structure. This directory will contain 4 folders
in which to store the yaml workflow files that map data, perform
analysis, produce reporting data, and generate the output of a module.
Each module output requires it’s own unique yaml in the
<code>4_modules</code> folder, which will take inputs generated from the
previous three directories.</p>
<div class="section level4">
<h4 id="mappings">
<code>/1_mappings</code><a class="anchor" aria-label="anchor" href="#mappings"></a>
</h4>
<p>The mappings folder contains all of the mappings from
<code>Raw_*</code> data to <code>Mapped_*</code> data. Each file within
this directory is to be named for the data table it is creating, minus
the <code>Mapped_</code> suffix. The yamls will contain the three
required sections, which are discussed in detail in the
<code>Module Configuration</code> section above. The yamls in this
folder will be combined via <code><a href="../reference/CombineSpecs.html">CombineSpecs()</a></code> to create a
master spec that defines all necessary tables and columns for the
module(s) in this package.</p>
<p>Below are two examples of these mapping yaml files- the first which
requires no transformations, and is very simple, and the second which
requires multiple steps to produce the desired mapped data.</p>
<div class="section level5">
<h5 id="mapped_ae-mapping-yaml-file">Mapped_AE mapping yaml file<a class="anchor" aria-label="anchor" href="#mapped_ae-mapping-yaml-file"></a>
</h5>
<pre><code>meta:
  Type: Mapped
  ID: AE
  Description: Adverse Event Data Mapping 
  Priority: 1
spec: 
 Raw_AE:
    subjid:
      required: true
      type: character
    aeser:
      required: true
      type: character
steps:
  - output: Mapped_AE
    name: =
    params:
      lhs: Mapped_AE
      rhs: Raw_AE</code></pre>
</div>
<div class="section level5">
<h5 id="mapped_datachg-mapping-yaml-file">Mapped_DATACHG mapping yaml file<a class="anchor" aria-label="anchor" href="#mapped_datachg-mapping-yaml-file"></a>
</h5>
<pre><code>meta:
  Type: Mapped
  ID: DATACHG
  Description: Data Changes Data Mapping 
  Priority: 2
spec: 
  Raw_DATACHG:
    subject_nsv:
      required: true
      type: character
      source_col: subjectname
    n_changes:
      required: true
      type: integer
  Mapped_SUBJ:
    subjid:
      required: true
      type: character
    subject_nsv:
      required: true
      type: character
steps:
  # Merge [ subjid ] onto EDC domains.
  - output: Temp_SubjectLookup
    name: select
    params:
      .data: Mapped_SUBJ
      subjid: subjid
      subject_nsv: subject_nsv
  - output: Mapped_DATACHG
    name: left_join
    params:
      x: Raw_DATACHG
      "y": Temp_SubjectLookup
      by: subject_nsv</code></pre>
</div>
</div>
<div class="section level4">
<h4 id="metrics">
<code>/2_metrics</code><a class="anchor" aria-label="anchor" href="#metrics"></a>
</h4>
<p>The metrics directory contains all of the workflows that perform
analysis steps, converting mapped data into metrics that are displayed
in a report. In the case of <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a>, these metrics are the 12
Key Risk Indicators, calculated at both the site- and country-level,
that are discussed in the Data Analysis Step-by-Step Vignette. Each yaml
in this file produces a list of analysis data tables that capture the
formatted input table, the transformed table, the flagged table, and the
summary table. In general, these yamls should at least provide a summary
table that contains statistics about the metric at the specified level
of aggregation.</p>
<p>Examples of these yamls can be found above in the
<code>Module Configuration</code> section, as well as in the
(<code><a href="../articles/DataAnalysis.html">vignette("DataAnalysis")</a></code>) vignette.</p>
</div>
<div class="section level4">
<h4 id="reporting">
<code>/3_reporting</code><a class="anchor" aria-label="anchor" href="#reporting"></a>
</h4>
<p>The reporting directory is intended to hold all of the workflows that
produce the data that is required for the module outputs. This typically
requires the stacking of analysis data from all of the relevant metrics
into a single <code>results</code> data frame that can be surfaced in a
report, or multiple reports. Additionally, any further information that
must be taken from the analysis output, such as study/site/group/metric
metadata and supporting statistics will be constructed through workflows
in this folder.</p>
<p>Examples of these yamls can be found above in the
<code>Module Configuration</code> section, as well as in
<code><a href="../articles/DataReporting.html">vignette("DataReporting")</a></code>.</p>
</div>
<div class="section level4">
<h4 id="modules">
<code>/4_modules</code><a class="anchor" aria-label="anchor" href="#modules"></a>
</h4>
<p>The modules directory contains the final workflow(s) of the reporting
pipeline. These workflows each produce a single output based on the data
tables that have been produced in the previous directories. These module
workflows will contain all of the necessary meta information, as
detailed in the <code>Module Configuration</code> section above, along
with the data tables required, and steps to produce it, so that
<code><a href="../reference/RunWorkflow.html">gsm::RunWorkflow()</a></code> can take this workflow and produce the
module output.</p>
<p>Below is an example of the module yaml workflow for the KRI Site
Report in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a></p>
<pre><code>meta:
  Type: Report 
  ID: report_kri_site
  Output: html
  Name: Site-Level Key Risk Indicator Report
  Description: A report summarizing key risk indicators at the site level
  Repo: gsm v2.1.0
  Status: Qualified
  Permission: Users
  Outputs: An html report
  ExampleURL: https://gilead-biostats.github.io/gsm/report_kri_site.html
spec:
  Reporting_Results:
    _all:
      required: true
  Reporting_Metrics:
    _all:
      required: true
  Reporting_Groups:
    _all:
      required: true
  Reporting_Bounds:
    _all:
      required: true
steps:
  - name: RunQuery
    output: Reporting_Results_Site
    params:
      df: Reporting_Results
      strQuery: "SELECT * FROM df WHERE GroupLevel == 'Site'"
  - name: RunQuery
    output: Reporting_Metrics_Site
    params:
      df: Reporting_Metrics
      strQuery: "SELECT * FROM df WHERE GroupLevel == 'Site'"
  - name: MakeCharts
    output: lCharts_Site
    params:
      dfResults: Reporting_Results_Site
      dfGroups: Reporting_Groups
      dfBounds: Reporting_Bounds
      dfMetrics: Reporting_Metrics_Site
  - name: Report_KRI
    output: lReport
    params:
      lCharts: lCharts_Site
      dfResults: Reporting_Results_Site
      dfGroups: Reporting_Groups
      dfMetrics: Reporting_Metrics_Site</code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by George Wu, Jeremy Wildfire, Matt Roumaya, Spencer Childress, Laura Maxwell, Jacob Anderson, Jon Harmon, Zelos Zhu, Nathan Kosiba, Douglas Sanders, Li Ge, Zhongkai Wang, Colleen McLaughlin, Chelsea Dickens, Maya Gans.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
