<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KRI Method • gsm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="KRI Method">
<meta property="og:description" content="gsm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gsm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.8.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Cookbook.html">Cookbook</a>
    </li>
    <li>
      <a href="../articles/DataAnalysis.html">Step-by-Step Analysis Workflow</a>
    </li>
    <li>
      <a href="../articles/DataPipeline.html">Data Pipeline</a>
    </li>
    <li>
      <a href="../articles/ContributorGuidelines.html">Contributor Guidelines</a>
    </li>
    <li>
      <a href="../articles/KRI%20Method.html">KRI Method</a>
    </li>
    <li>
      <a href="../articles/Qualification.html">Qualification Report for the {gsm} R Package</a>
    </li>
    <li>
      <a href="../articles/QualificationWorkflow.html">Qualification Workflow</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Sample Reports
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../StandardReportSite.html">Site Report</a>
    </li>
    <li>
      <a href="../StandardReportCountry.html">Country Report</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Gilead-BioStats/gsm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>KRI Method</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Gilead-BioStats/gsm/blob/HEAD/vignettes/articles/KRI%20Method.Rmd" class="external-link"><code>vignettes/articles/KRI Method.Rmd</code></a></small>
      <div class="hidden name"><code>KRI Method.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette outlines the statistical methods used to evaluate Key
Risk Indicators (KRIs) in {gsm}. KRIs are metrics that allow users to
measure pre-defined risks and determine the level of observed risk to
data quality and patient safety in a clinical trial. The {gsm} package
implements a standardized data pipeline to facilitate KRI analysis.
Other vignettes provide an overview of this framework (<a href="https://gilead-biostats.github.io/gsm/" class="external-link">1</a>, <a href="https://gilead-biostats.github.io/gsm/articles/Cookbook.html" class="external-link">2</a>
<a href="https://gilead-biostats.github.io/gsm/articles/DataPipeline.html" class="external-link">3</a>,
<a href="https://gilead-biostats.github.io/gsm/articles/DataAnalysis.html" class="external-link">4</a>),
and the statistical methods for this process are described in detail
below.</p>
<p>GSM calculates KRIs by defining a numerator and a denominator for
each metric. Then by default, GSM calculates z-scores using a normal
approximation with adjustment for over-dispersion to assign risk
levels.</p>
<p>For KRIs that are percentages (binary outcome), the numerator is the
# of events and the denominator is the # of total participants, and we
then apply the normal approximation of the binomial distribution to
determine a risk level.</p>
<p>For KRIs that are rates (count outcome), the numerator is the # of
events and the denominator is the total participant exposure or study
duration, and we then apply the normal approximation of the Poisson
distribution to determine a risk level.</p>
<p>Alternative statistical methods to calculate standardized scores are
also available in {gsm}, including the Identity, Fisher and Poisson
methods. More details are provided below.</p>
</div>
<div class="section level2">
<h2 id="statistical-methods">Statistical Methods<a class="anchor" aria-label="anchor" href="#statistical-methods"></a>
</h2>
<div class="section level3">
<h3 id="the-normal-approximation-method">1. The Normal Approximation Method<a class="anchor" aria-label="anchor" href="#the-normal-approximation-method"></a>
</h3>
<div class="section level4">
<h4 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h4>
<p>This method applies normal approximation of binomial distribution to
the binary outcome KRIs, or normal approximation of Poisson distribution
for the rate outcome KRIs (the sample sizes or total exposure of the
sites) to assess data quality and safety. The control limits based on
the asymptotic normal approximation are constructed to as risk
thresholds for identifying site-level risks.</p>
<p>Reference: Zink, Richard C., Anastasia Dmitrienko, and Alex
Dmitrienko. <strong>Rethinking the clinically based thresholds of
TransCelerate BioPharma for risk-based monitoring.</strong>
<em>Therapeutic Innovation &amp; Regulatory Science</em> 52, no. 5
(2018): 560-571.</p>
</div>
<div class="section level4">
<h4 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h4>
<div class="section level5">
<h5 id="binary">Binary<a class="anchor" aria-label="anchor" href="#binary"></a>
</h5>
<p>Consider the problem of monitoring KRIs with binary outcomes, such as
protocol deviation or discontinuation from the study, across multiple
sites in a clinical trial. Assume that there are <span class="math inline">\(m\)</span> sites with <span class="math inline">\(n_i\)</span> patients at the <span class="math inline">\(i\)</span> th site, <span class="math inline">\(i
= 1, 2, \dots, m\)</span>. Denote the total number of patients in the
study by <span class="math inline">\(n=\sum_{i=1}^m n_i\)</span>. Let
<span class="math inline">\(X_{ij}\)</span> signify the outcome of
interest for the <span class="math inline">\(j\)</span> th patient at
the <span class="math inline">\(i\)</span> th site, where <span class="math inline">\(X_{ij}=1\)</span> indicates that an event has
occurred and indicates that an event has not occurred. Finally, let
<span class="math inline">\(p_i\)</span> denote the site-level
proportion at the <span class="math inline">\(i\)</span> th site.
Monitoring tools focus on testing the null hypothesis of consistency of
the true site-level proportion across multiple sites. Specifically, the
null hypothesis states that the site-level proportion of the binary
outcome is constant across the sites, that is, <span class="math inline">\(H_0: p_1 = \dots = p_m = p\)</span>, where <span class="math inline">\(p\)</span> is the common proportion. This common
proportion can be estimated as <span class="math inline">\(\hat{p} =
\frac{1}{n}\sum_{i=1}^m\sum_{j=1}^{n_i}X_{ij}\)</span>.</p>
<p>The control limits are computed using confidence limits based on an
asymptotic normal approximation. A 95% confidence interval is obtained
if the significance level <span class="math inline">\(\alpha=0.05\)</span>. Let <span class="math inline">\(X_i=\sum_{j=1}^{n_i}X_{ij}\)</span> represent the
total number of events that occur and let <span class="math inline">\(\hat{p}_i=X_i/n_i\)</span> denote the estimated
event rate at the <span class="math inline">\(i\)</span> th site. The
asymptotic <span class="math inline">\(100(1 – \alpha)%\)</span>
confidence interval for <span class="math inline">\(p_i\)</span> is
given by <span class="math display">\[
\hat{p}_i-z_{1-\alpha/2}\sqrt{\frac{\hat{p}_i(1-\hat{p}_i)}{n_i}} \leq
p_i \leq
\hat{p}_i+z_{1-\alpha/2}\sqrt{\frac{\hat{p}_i(1-\hat{p}_i)}{n_i}}
\]</span> where <span class="math inline">\(z_{1-\alpha/2}\)</span> is
the upper percentile of the standard normal distribution. To construct
the control limits for the observed event rate at this site, the
estimated event rate is forced to be equal to the overall event rate
<span class="math inline">\(\hat{p}_i\)</span>. This means that the
lower (l) and upper (u) asymptotic control limits for the <span class="math inline">\(i\)</span> th site are defined as <span class="math inline">\(l_i=\hat{p}-z_{1-\alpha/2}\sqrt{\frac{\hat{p}(1-\hat{p})}{n_i}}\)</span>
and <span class="math inline">\(u_i=\hat{p}+z_{1-\alpha/2}\sqrt{\frac{\hat{p}(1-\hat{p})}{n_i}}\)</span>,
respectively. Asymptotic control limits may not be reliable in smaller
clinical trials, so exact limits for an event rate may be
preferable.</p>
</div>
<div class="section level5">
<h5 id="rate">Rate<a class="anchor" aria-label="anchor" href="#rate"></a>
</h5>
<p>Assume that the distribution of number of events up to time <span class="math inline">\(T\)</span> is Poisson with mean <span class="math inline">\(\lambda t\)</span>, where <span class="math inline">\(\lambda\)</span> is the event rate for a given
unit of time. For the <span class="math inline">\(i\)</span> th site
with <span class="math inline">\(X_i=\sum_{j=1}^{N_i}X_{ij}\)</span>
events and <span class="math inline">\(T_i=\sum_{j=1}^{N_i}t_{ij}\)</span> exposure,
define the exposure-adjusted incidence rate (EAIR) as <span class="math inline">\(\hat{\lambda}_i=\frac{X_i}{T_i}\)</span>. For all
sites, define <span class="math inline">\(X=\sum_{i=1}^{m}X_{i}\)</span>
and <span class="math inline">\(T=\sum_{i=1}^{m}t_{i}\)</span> with
<span class="math inline">\(\hat{\lambda}=\frac{X}{T}\)</span>. Under a
normal approximation, <span class="math inline">\(100(1 – a)%\)</span>
confidence interval for the <span class="math inline">\(i\)</span> th
site is <span class="math display">\[
\hat{\lambda}_i-z_{1-\alpha/2}\sqrt{\frac{\hat{\lambda}_i}{T_i}} \leq
p_i \leq
\hat{\lambda}_i+z_{1-\alpha/2}\sqrt{\frac{\hat{\lambda}_i}{T_i}}
\]</span>. For these funnel plots accounting for exposure, the x-axis
representing the site sample size (<span class="math inline">\(n\)</span>) in the above examples is replaced by
the total exposure time <span class="math inline">\(T\)</span>. To
develop a funnel plot, fix <span class="math inline">\(\hat{\lambda}_i=\hat{\lambda}\)</span>, and vary
<span class="math inline">\(T\)</span> from <span class="math inline">\(min(T_i)\)</span> to <span class="math inline">\(max(T_i)\)</span> to compute the control limits.
As an area of future research, the work of Chan and Wang (2009) may
suggest methods appropriate for computing an exact confidence interval
for the EAIR. Finally, similar methods can be applied for a count-type
endpoint <span class="math inline">\(X_{ij}\)</span>, where tij would
denote the time on study for the <span class="math inline">\(j\)</span>
th patient at the <span class="math inline">\(i\)</span> th site.</p>
</div>
</div>
<div class="section level4">
<h4 id="kri-metric-and-z-score">KRI Metric and Z-score<a class="anchor" aria-label="anchor" href="#kri-metric-and-z-score"></a>
</h4>
<p>The KRI metric along with a KRI score are created for each site to
measure the level of observed risk to data quality and patient safety in
a clinical trial. For scoring purposes, Z-scores from the normal
approximation are calculated and defined as such: <span class="math inline">\(z_i=\frac{y_i-\theta_0}{\sqrt{V(Y|\theta_0)}}\)</span>
for site <span class="math inline">\(i\)</span>, where <span class="math inline">\(y_i\)</span> is the KRI metric calculated for site
<span class="math inline">\(i\)</span>, <span class="math inline">\(\theta_0\)</span> is the overall mean, <span class="math inline">\(\sqrt{V(Y|\theta_0)}\)</span> is the measurement
of variance.</p>
<p>For binary outcome, <span class="math inline">\(\sqrt{V(Y|\theta_0)}=\sqrt{\frac{\hat{p}(1-\hat{p})}{n_i}}\)</span>.</p>
<p>For rate outcome, <span class="math inline">\(\sqrt{V(Y|\theta_0)}=\sqrt{\frac{\hat{\lambda}}{T_i}}\)</span>.</p>
</div>
<div class="section level4">
<h4 id="over-dispersion-adjustment">Over-dispersion adjustment<a class="anchor" aria-label="anchor" href="#over-dispersion-adjustment"></a>
</h4>
<p>The standard normal approximation method described above assumes the
null distribution fully expresses the variability of the sites
in-control, but in many situations this assumption will not hold. In the
situation that there is a presence of greater variability than expected,
majority of the sites will fall outside the specified limits, leading to
a double of the approperatenesss of the constructed limits.</p>
<p>A way of handling this issue is to allow over-dispersion in the
normal approximation. A multiplicative over-dispersion adjustment was
implemented in our approach.</p>
<p>Suppose a sample of <span class="math inline">\(m\)</span> units are
to be <strong>in-control</strong>, the over-dispersion factor <span class="math inline">\(\phi\)</span> can be estimated as the mean squared
z-scores, i.e., <span class="math inline">\(\hat\phi =
\frac{1}{m}\sum_{i=1}^m z_i^2\)</span>. For binary outcome, the
over-dispersion adjusted variance is <span class="math inline">\(V'(Y_i|\phi,
p)=\phi\frac{{p}(1-p)}{n_i}\)</span>. For rate outcome, the
over-dispersion adjusted variance is <span class="math inline">\(V'(Y_i|\phi,
\lambda)=\phi\frac{\lambda}{T_i}\)</span>. Therefore, after the
over-dispersion adjustment, the adjusted z-scores for site <span class="math inline">\(i\)</span> are <span class="math inline">\(z_i =
\frac{\hat{p}_i - \hat{p}}{\sqrt{\hat\phi
\frac{{\hat{p}}(1-\hat{p})}{n_i}}}\)</span>, <span class="math inline">\(z_i = \frac{\hat{\lambda}_i -
\hat{\lambda}}{\sqrt{\hat\phi \frac{\hat\lambda}{T_i}}}\)</span>,
respectively.</p>
<p>Reference: Spiegelhalter, David J. <strong>Funnel plots for comparing
institutional performance.</strong> <em>Statistics in medicine</em> 24.8
(2005): 1185-1202.</p>
</div>
<div class="section level4">
<h4 id="estimate-and-score">Estimate and Score<a class="anchor" aria-label="anchor" href="#estimate-and-score"></a>
</h4>
<p>The function <code><a href="../reference/Analyze_NormalApprox.html">Analyze_NormalApprox()</a></code> in
<a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> calculates adjusted z-score for each site as
discussed above. The adjusted z-scores are then used as a scoring metric
in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> to flag possible outliers using the thresholds
discussed below.</p>
</div>
<div class="section level4">
<h4 id="threshold">Threshold<a class="anchor" aria-label="anchor" href="#threshold"></a>
</h4>
<p>By default, sites with adjusted z-score exceeding <span class="math inline">\(\pm 2\)</span> or <span class="math inline">\(\pm
3\)</span> from the normal approximation analysis are flagged as amber
or red, respectively. The thresholds are set at common choices
corresponding to 95.6% and 99.7% of the data around the mean in a
standard normal distribution. However, they are fully configurable in
the package and can be customized and specified in the {gsm}
functions.</p>
</div>
<div class="section level4">
<h4 id="special-situations">Special Situations<a class="anchor" aria-label="anchor" href="#special-situations"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Results are not interpretable or it is not appropriate to apply the
asymptotic method: We don’t want to flag in certain situations when
results not interpretable or when it is not appropriate to apply the
asymptotic method due to the small sample sizes. The default threshold
for minimum denominator requirement is 30 days exposure or 3 patients at
the site level.</li>
</ol>
</div>
<div class="section level4">
<h4 id="recommendation">Recommendation<a class="anchor" aria-label="anchor" href="#recommendation"></a>
</h4>
<p>Normal approximation method can be used in all scenarios with binary
or rate KRIs.</p>
</div>
</div>
<div class="section level3">
<h3 id="the-identity-method">2. The Identity Method<a class="anchor" aria-label="anchor" href="#the-identity-method"></a>
</h3>
<p>Identity method simply uses the count of event in the numerator of
the KRI metric itself as the score. The thresholds for monitoring site
risk are set based on the actual counts.</p>
</div>
<div class="section level3">
<h3 id="the-fishers-exact-method">3. The Fisher’s Exact Method<a class="anchor" aria-label="anchor" href="#the-fishers-exact-method"></a>
</h3>
<div class="section level4">
<h4 id="introduction-1">Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"></a>
</h4>
<p>For the binary outcome KRIs, an optional method in {gsm} is
implemented with Fisher’s exact test.</p>
<p>Fisher’s exact test is a statistical significance test used in the
analysis of contingency tables when we have nominal variables and want
to find out if proportions for one variable are different among values
of the other variables.</p>
<p>In contrast to large-sample based asymptotic statistics which rely on
approximation, Fisher’s exact test can be applied when sample sizes are
small.</p>
<p>The function <code>Analyze_Fisher</code> in {gsm} utilizes
<code><a href="https://rdrr.io/r/stats/fisher.test.html" class="external-link">stats::fisher.test</a></code> to generate an estimate of odds ratio as
well as p-value using the Fisher’s exact test with site-level count
data. For each site, Fisher’s exact test is conducted by comparing to
all other sites combined in a 2×2 contingency table. The p-values are
then used as a scoring metric in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> to flag possible
outliers. The default in <code><a href="https://rdrr.io/r/stats/fisher.test.html" class="external-link">stats::fisher.test</a></code> uses a
two-sided test (equivalent to testing the null of OR = 1) and does not
compute p-values by Monte Carlo simulation unless
<code>simulate.p.value = TRUE</code>. Sites with p-values less than 0.05
from the Fisher’s exact test analysis are flagged by default. The
significance level was set at a common choice.</p>
</div>
<div class="section level4">
<h4 id="methods-1">Methods<a class="anchor" aria-label="anchor" href="#methods-1"></a>
</h4>
<p>For example, in a <span class="math inline">\(2 \times 2\)</span>
contingency table comparing a particular site to all other sites
combined, the two rows displaying the binary outcome are considered
repeated Bernoulli random samples with same probability <span class="math inline">\(p=0.5\)</span> of success or failure under the
null. Given a <span class="math inline">\(2 \times 2\)</span>
contingency table,</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">Site1</th>
<th align="left">RestSites</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Yes</td>
<td align="left">a</td>
<td align="left">c</td>
</tr>
<tr class="even">
<td align="left">No</td>
<td align="left">b</td>
<td align="left">d</td>
</tr>
</tbody>
</table>
<p>Fisher (1922) showed that conditional on the margins of the table,
<span class="math inline">\(a\)</span> is distributed as a
hypergeometric distribution with <span class="math inline">\(a+c\)</span> draws from a population with <span class="math inline">\(a+b\)</span> successes and <span class="math inline">\(c+d\)</span> failures. Let <span class="math inline">\(n=a+b+c+d\)</span>, the probability of obtaining
such set of values is given by:</p>
<p><span class="math display">\[
p=\frac{{{a+b} \choose a} {{c+d} \choose c}}{{n \choose
{a+c}}}=\frac{{{a+b} \choose b} {{c+d} \choose d}}{{n \choose
{b+d}}}=\frac{(a+b)!(c+d)!(a+c)!(b+d)!}{a! b! c! d! n!}.
\]</span></p>
</div>
<div class="section level4">
<h4 id="estimate-and-score-1">Estimate and Score<a class="anchor" aria-label="anchor" href="#estimate-and-score-1"></a>
</h4>
<p>The function <code><a href="../reference/Analyze_Fisher.html">Analyze_Fisher()</a></code> in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a>
utilizes <code><a href="https://rdrr.io/r/stats/fisher.test.html" class="external-link">stats::fisher.test()</a></code> to generate an estimate of
odds ratio as well as p-value using the Fisher’s exact test with
site-level count data. For each site, Fisher’s exact test is conducted
by comparing to all other sites combined in a <span class="math inline">\(2 \times 2\)</span> contingency table. The
p-values are then used as a scoring metric in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> to flag
possible outliers using the thresholds discussed below. The default in
<code><a href="https://rdrr.io/r/stats/fisher.test.html" class="external-link">stats::fisher.test()</a></code> uses two-sided test (equivalent to
testing the null: OR=1) and not to compute p-values by Monte Carlo
simulation unless <code>simulate.p.value = TRUE</code> is specified.</p>
</div>
<div class="section level4">
<h4 id="threshold-1">Threshold<a class="anchor" aria-label="anchor" href="#threshold-1"></a>
</h4>
<p>By default, sites with p-values less than 0.05 or 0.01 from the
Fisher’s exact test analysis are flagged as amber or red, respectively.
The thresholds are set based on empirical p-value approach, where we use
the distribution of the p-values to find the best separation of the data
to identify sites at risk. The default thresholds are set at common
choices of significance levels. However, they are fully configurable in
the package and can be customized and specified in the {gsm}
functions.</p>
</div>
<div class="section level4">
<h4 id="the-fishers-exact-test-assumptions">The Fisher’s exact test assumptions<a class="anchor" aria-label="anchor" href="#the-fishers-exact-test-assumptions"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>The row totals and the column totals are both fixed by
design.</p></li>
<li><p>The samples are mutually exclusive and mutually
independent.</p></li>
</ol>
<p>The assumptions can be assessed by the knowledge of data collected.
No assumption check is necessary.</p>
</div>
<div class="section level4">
<h4 id="special-situations-1">Special situations<a class="anchor" aria-label="anchor" href="#special-situations-1"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>Functionally: where we don’t have required input to run Fishers:
p-value will be set <code>NA</code>.</p></li>
<li><p>Results not interpretable: we don’t want to flag in certain
situations when results not interpretable due to small sample sizes. The
default threshold for minimum denominator requirement is 3 patients at
the site level.</p></li>
<li><p>An observed zero cell is not an issue when using Fisher’s exact
test, however, when the expected cell is zero, it means either the
marginal is zero (meaningless) or there are structural zeros (need to
consider zero-inflated issue: West, L. and Hankin, R. (2008), “Exact
Tests for Two-Way Contingency Tables with Structural Zeros,” Journal of
Statistical Software, 28(11), 1–19).</p></li>
</ol>
</div>
<div class="section level4">
<h4 id="constraints">constraints<a class="anchor" aria-label="anchor" href="#constraints"></a>
</h4>
<p>For small samples, Fisher’s exact test is highly discrete. Fisher’s
exact test is often considered to be more conservative. This may due to
the use a discrete statistic with fixed significance levels (<a href="https://en.wikipedia.org/wiki/Fisher%27s_exact_test#Controversies" class="external-link">FET
Controversies Wiki</a>).</p>
<p>Although in practice, Fisher’s exact test is usually used when sample
sizes are small (e.g., n&lt;5), it is valid for all sample sizes.
However, when sample sizes are large, the computation of the exact test
evaluating the hypergeometric probability function given the marginal
can take a very long time.</p>
</div>
<div class="section level4">
<h4 id="recommendation-1">Recommendation<a class="anchor" aria-label="anchor" href="#recommendation-1"></a>
</h4>
<p>Fisher’s exact test can be used in all scenarios with binary
KRIs.</p>
</div>
</div>
<div class="section level3">
<h3 id="the-poisson-regression-method">4. The Poisson Regression Method<a class="anchor" aria-label="anchor" href="#the-poisson-regression-method"></a>
</h3>
<div class="section level4">
<h4 id="introduction-2">Introduction<a class="anchor" aria-label="anchor" href="#introduction-2"></a>
</h4>
<p>For the rate outcome KRIs, an optional method in {gsm} is implemented
with Poisson regression.</p>
<p>The Poisson distribution is often used to model count data. If <span class="math inline">\(Y\)</span> is the number of counts following
Poisson distribution, the probability mass function is given by <span class="math display">\[
f(y)=\frac{\mu^ye^{-\mu}}{y!}
\]</span> where <span class="math inline">\(\mu\)</span> is the average
number of counts and <span class="math inline">\(E(Y)=Var(Y)=\mu\)</span>.</p>
</div>
<div class="section level4">
<h4 id="methods-2">Methods<a class="anchor" aria-label="anchor" href="#methods-2"></a>
</h4>
<p>This method fits a Poisson model to site-level data and then
calculates deviance residuals for each site. The Poisson model is run
using standard methods in the <code>stats</code> package by fitting a
<code>glm</code> model with family set to <code>poisson</code> using a
“log” link. Site-level deviance residuals are calculated using
<code>resid</code> from <code><a href="https://rdrr.io/r/stats/predict.glm.html" class="external-link">stats::predict.glm</a></code> via
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">broom::augment</a></code>.</p>
<p>Let <span class="math inline">\(Y_1, ..., Y_N\)</span> be independent
random variables with <span class="math inline">\(Y_i \sim
Poisson(\mu_i)\)</span> denoting the number of events observed from
<span class="math inline">\(n_i\)</span> for the <span class="math inline">\(i\)</span>th observation following Poisson
distribution. Then <span class="math inline">\(E(Y_i)=\mu_i=n_ie^{x_i\beta}\)</span>. Thus,the
log-linear generalized linear model (Poisson regression) is <span class="math display">\[
\log{\mu_i}=\log{n_i}+x_i\beta \quad Y_i \sim Poisson(\mu_i)
\]</span></p>
<p>where <span class="math inline">\(\log{n_i}\)</span> is an offset
term.</p>
</div>
<div class="section level4">
<h4 id="estimate-and-score-2">Estimate and Score<a class="anchor" aria-label="anchor" href="#estimate-and-score-2"></a>
</h4>
<p>The function <code><a href="../reference/Analyze_Poisson.html">Analyze_Poisson()</a></code> in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a>
utilizes <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> to generate an estimate of fitted
values as well as deviance residual with site-level count data. The
p-values are then used as a scoring metric in <a href="https://github.com/Gilead-BioStats/gsm" class="external-link">gsm</a> to flag
possible outliers using the thresholds discussed below.</p>
</div>
<div class="section level4">
<h4 id="threshold-2">Threshold<a class="anchor" aria-label="anchor" href="#threshold-2"></a>
</h4>
<p>By default, sites with deviance residuals exceeding <span class="math inline">\(\pm 5\)</span> or <span class="math inline">\(\pm
7\)</span> from the Poisson analysis are flagged as amber or red,
respectively. The thresholds are set based on empirical approach, where
we use the distribution of the deviance residuals to find the best
separation of the data to identify sites at risk. The default thresholds
are set at empirical values based on pilot studies’ data. However, they
are fully configurable in the package and can be customized and
specified in the {gsm} functions.</p>
</div>
<div class="section level4">
<h4 id="special-situations-2">Special Situations<a class="anchor" aria-label="anchor" href="#special-situations-2"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Results are not interpretable or it is not appropriate to apply the
Poisson method: We don’t want to flag in certain situations when results
not interpretable or when it is not appropriate to apply the Poisson
method due to the small sample sizes. The default threshold for minimum
denominator requirement is 30 days exposure at the site level.</li>
</ol>
<!-- TODO. Discuss hard rules on STOP-IF-NOT situations -->
</div>
<div class="section level4">
<h4 id="poisson-regression-assumptions">Poisson regression assumptions<a class="anchor" aria-label="anchor" href="#poisson-regression-assumptions"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p><strong>Independence</strong> The responses <span class="math inline">\(y_i\)</span> are independent of each
other.</p></li>
<li><p><strong>Count data</strong> The responses <span class="math inline">\(y_i\)</span> are non-negative integer
(counts).</p></li>
<li><p><strong>Poisson response</strong> Each <span class="math inline">\(Y_i\)</span> follows the Poisson distribution as
noted above with mean and variance equal to <span class="math inline">\(\mu_i\)</span>.</p></li>
<li><p><strong>Linearity</strong> <span class="math inline">\(\log{\mu_i}=\log{n_i}+x_i\beta\)</span> where
<span class="math inline">\(x_i\)</span> are independent
predictors.</p></li>
</ol>
</div>
<div class="section level4">
<h4 id="assumption-checks-constraints-and-model-diagnosis">Assumption checks, constraints and model diagnosis<a class="anchor" aria-label="anchor" href="#assumption-checks-constraints-and-model-diagnosis"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>The assumptions on independence and counted data can be assessed
by the knowledge of data collected.</p></li>
<li><p>The assumptions on Poisson response can be checked by plotting
histogram of the data and comparing empirical mean and variance
stratified by the explanatory variable(s). If there is evidence that the
assumption of mean=variance is violated, oftentimes we observe
variance&gt;mean. This is called overdispersion. In this case, negative
binomial distribution provides an alternative where <span class="math inline">\(Var(Y_i)=\phi E(Y_i)\)</span>.</p></li>
<li><p>Diagnosis: Goodness of fit test (chi-squared) and deviance
residuals. Residuals vs fitted plot. Q-Q plot.</p></li>
<li><p>Other considerations: Structural zeros may happen in contrast to
random zeros due to sampling from poisson distribution. In this case, a
mixture model (zero-inflated Poisson model) may be required.</p></li>
</ol>
</div>
<div class="section level4">
<h4 id="recommendation-2">Recommendation<a class="anchor" aria-label="anchor" href="#recommendation-2"></a>
</h4>
<p>Use this method when Poisson assumptions hold.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by George Wu, Jeremy Wildfire, Matt Roumaya, Nathan Kosiba, Douglas Sanders, Spencer Childress, Li Ge, Zhongkai Wang, Colleen McLaughlin, Chelsea Dickens, Maya Gans, Jacob Anderson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
