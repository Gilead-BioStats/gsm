<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Query Rate Assessment — QueryRate_Assess • gsm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Query Rate Assessment — QueryRate_Assess"><meta property="og:description" content="Evaluates query rates to identify sites that may be over- or under-reporting queries."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gsm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Cookbook.html">Cookbook</a>
    </li>
    <li>
      <a href="../articles/DataAnalysis.html">Step-by-Step Analysis Workflow</a>
    </li>
    <li>
      <a href="../articles/DataPipeline.html">Data Pipeline</a>
    </li>
    <li>
      <a href="../articles/ContributorGuidelines.html">Contributor Guidelines</a>
    </li>
    <li>
      <a href="../articles/KRI%20Method.html">KRI Method</a>
    </li>
    <li>
      <a href="../articles/Qualification.html">Qualification Report for the {gsm} R Package</a>
    </li>
    <li>
      <a href="../articles/QualificationWorkflow.html">Qualification Workflow</a>
    </li>
    <li>
      <a href="../articles/v1_9_0-data-model-update-reference.html">v1.9.0 Data Model Update Reference</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Sample Reports
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../StandardReportSite.html">Site Report</a>
    </li>
    <li>
      <a href="../StandardReportCountry.html">Country Report</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/Gilead-BioStats/gsm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Query Rate Assessment</h1>
    <small class="dont-index">Source: <a href="https://github.com/Gilead-BioStats/gsm/blob/HEAD/R/QueryRate_Assess.R" class="external-link"><code>R/QueryRate_Assess.R</code></a></small>
    <div class="hidden name"><code>QueryRate_Assess.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Evaluates query rates to identify sites that may be over- or under-reporting queries.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">QueryRate_Assess</span><span class="op">(</span></span>
<span>  <span class="va">dfInput</span>,</span>
<span>  vThreshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strMethod <span class="op">=</span> <span class="st">"NormalApprox"</span>,</span>
<span>  lMapping <span class="op">=</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"mappings"</span>, <span class="st">"QueryRate_Assess.yaml"</span>, package <span class="op">=</span></span>
<span>    <span class="st">"gsm"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  lLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>workflowid <span class="op">=</span> <span class="st">""</span>, group <span class="op">=</span> <span class="va">strGroup</span>, abbreviation <span class="op">=</span> <span class="st">"QRY"</span>, metric <span class="op">=</span></span>
<span>    <span class="st">"Query Rate"</span>, numerator <span class="op">=</span> <span class="st">"Total Queries"</span>, denominator <span class="op">=</span> <span class="st">"Total Data Points"</span>, model <span class="op">=</span></span>
<span>    <span class="st">"Normal Approximation"</span>, score <span class="op">=</span> <span class="st">"Adjusted Z-Score"</span><span class="op">)</span>,</span>
<span>  strGroup <span class="op">=</span> <span class="st">"Site"</span>,</span>
<span>  nMinDenominator <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bMakeCharts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  bQuiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>dfInput</dt>
<dd><p><code>data.frame</code> Input data, a data frame with one record per data point.</p></dd>


<dt>vThreshold</dt>
<dd><p><code>numeric</code> Threshold specification, a vector of length 4 that defaults to <code>c(-3, -2, 2, 3)</code> for a Normal Approximation,
<code>c(-7, -5, 5, 7)</code> for a Poisson model (<code>strMethod = "Poisson"</code>) and a vector of length 2 that defaults to <code>c(0.00006, 0.01)</code>
for a nominal assessment (<code>strMethod = "Identity"</code>).</p></dd>


<dt>strMethod</dt>
<dd><p><code>character</code> Statistical method. Valid values:</p><ul><li><p><code>"NormalApprox"</code> (default)</p></li>
<li><p><code>"Poisson"</code></p></li>
<li><p><code>"Identity"</code></p></li>
</ul></dd>


<dt>lMapping</dt>
<dd><p>Column metadata with structure <code>domain$key</code>, where <code>key</code> contains the name
of the column. Default: package-defined Adverse Event Assessment mapping.</p></dd>


<dt>lLabels</dt>
<dd><p><code>list</code> Labels used to populate chart labels.</p></dd>


<dt>strGroup</dt>
<dd><p><code>character</code> Grouping variable. <code>"Site"</code> (the default) uses the column named in <code>mapping$strSiteCol</code>. Other valid options using the default mapping are <code>"Study"</code>, <code>"Country"</code>, and <code>"CustomGroup"</code>.</p></dd>


<dt>nMinDenominator</dt>
<dd><p><code>numeric</code> Specifies the minimum denominator required to return a <code>score</code> and calculate a <code>flag</code>. Default: NULL</p></dd>


<dt>bMakeCharts</dt>
<dd><p><code>logical</code> Boolean value indicating whether to create charts.</p></dd>


<dt>bQuiet</dt>
<dd><p><code>logical</code> Suppress warning messages? Default: <code>TRUE</code></p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>list</code></p>
<p></p>
<p><code>lData</code>, a named list with:</p><ul><li><p>each data frame in the data pipeline</p><ul><li><p><code>dfTransformed</code>, returned by <code><a href="Transform_Rate.html">Transform_Rate()</a></code></p></li>
<li><p><code>dfAnalyzed</code>, returned by <code><a href="Analyze_NormalApprox.html">Analyze_NormalApprox()</a></code>, <code><a href="Analyze_Poisson.html">Analyze_Poisson()</a></code>, or <code><a href="Analyze_Identity.html">Analyze_Identity()</a></code></p></li>
<li><p><code>dfFlagged</code>, returned by <code><a href="Flag_NormalApprox.html">Flag_NormalApprox()</a></code>, <code><a href="Flag_Poisson.html">Flag_Poisson()</a></code>, or <code><a href="Flag.html">Flag()</a></code></p></li>
<li><p><code>dfSummary</code>, returned by <code><a href="Summarize.html">Summarize()</a></code></p></li>
<li><p><code>dfBounds</code>, returned by <code><a href="Analyze_NormalApprox_PredictBounds.html">Analyze_NormalApprox_PredictBounds()</a></code> or <code><a href="Analyze_Poisson_PredictBounds.html">Analyze_Poisson_PredictBounds()</a></code>
when <code>strMethod == "NormalApprox"</code> or <code>strMethod == "Poisson"</code>. <code>dfBounds</code> is not returned when using <code>strMethod == "Identity"</code>.</p></li>
</ul></li>
<li><p><code>list</code> <code>lCharts</code>, a named list with:</p><ul><li><p><code>scatter</code>, a ggplot2 object returned by <code><a href="Visualize_Scatter.html">Visualize_Scatter()</a></code> only when <code>strMethod != "Identity"</code></p></li>
<li><p><code>barMetric</code>, a ggplot2 object returned by <code><a href="Visualize_Score.html">Visualize_Score()</a></code></p></li>
<li><p><code>barScore</code>, a ggplot2 object returned by <code><a href="Visualize_Score.html">Visualize_Score()</a></code></p></li>
</ul></li>
<li><p><code>list</code> <code>lChecks</code>, a named list with:</p><ul><li><p><code>dfInput</code>, a named list returned by <code><a href="is_mapping_valid.html">is_mapping_valid()</a></code></p></li>
<li><p><code>status</code>, a boolean returned by <code><a href="is_mapping_valid.html">is_mapping_valid()</a></code></p></li>
<li><p><code>mapping</code>, a named list that is provided as an argument to the <code>lMapping</code> parameter in <code>QueryRate_Assess()</code></p></li>
<li><p><code>spec</code>, a named list used to define variable specifications</p></li>
</ul></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a></p>
<p>The Query Rate Assessment uses the standard <a href="https://gilead-biostats.github.io/gsm/articles/DataPipeline.html" class="external-link">GSM data pipeline</a> to flag possible outliers. Additional details regarding the data pipeline and statistical
methods are described below.</p>
    </div>
    <div id="data-specification">
    <h2>Data specification</h2>
    
<table class="table table"><tr><td><strong>Domain</strong></td><td><strong>Column Key</strong></td><td><strong>Default Value</strong></td><td><strong>Required?</strong></td></tr><tr><td>dfInput</td><td>strIDCol</td><td>SubjectID</td><td>TRUE</td></tr><tr><td>dfInput</td><td>strCountCol</td><td>Count</td><td>TRUE</td></tr><tr><td>dfInput</td><td>strGroupCol</td><td>SiteID</td><td>TRUE</td></tr></table></div>
    <div id="statistical-assumptions">
    <h2>Statistical assumptions</h2>
    <p>The default function <code>Analyze_NormalApprox</code> applies funnel plots using
asymptotic limits based on normal approximation of binomial distribution
for the binary outcome, or normal approximation of Poisson distribution
for the rate outcome with volume (the sample sizes or total exposure of
the sites) to assess data quality and safety.</p>
<p>Alternatively, a Poisson model is used to generate estimates and
p-values for each site (as specified with the <code>strMethod</code> parameter).
Those model outputs are then used to flag possible outliers using the
thresholds specified in <code>vThreshold</code>. Sites with an estimate less than
-5 are flagged as -1 and greater than 5 are flagged as 1 by default.</p>
<p>See <code><a href="Analyze_NormalApprox.html">Analyze_NormalApprox()</a></code> or
<code><a href="Analyze_Poisson.html">Analyze_Poisson()</a></code> for additional
details about the statistical methods and their assumptions.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">dfInput</span> <span class="op">&lt;-</span> <span class="fu"><a href="QueryRate_Map_Raw.html">QueryRate_Map_Raw</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run using normal approximation method (default)</span></span></span>
<span class="r-in"><span><span class="va">QueryRate_assessment_NormalApprox</span> <span class="op">&lt;-</span> <span class="fu">QueryRate_Assess</span><span class="op">(</span><span class="va">dfInput</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run using Poisson method</span></span></span>
<span class="r-in"><span><span class="va">QueryRate_assessment_poisson</span> <span class="op">&lt;-</span> <span class="fu">QueryRate_Assess</span><span class="op">(</span><span class="va">dfInput</span>, strMethod <span class="op">=</span> <span class="st">"Poisson"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run using Identity method</span></span></span>
<span class="r-in"><span><span class="va">QueryRate_assessment_identity</span> <span class="op">&lt;-</span> <span class="fu">QueryRate_Assess</span><span class="op">(</span><span class="va">dfInput</span>, strMethod <span class="op">=</span> <span class="st">"Identity"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by George Wu, Jeremy Wildfire, Matt Roumaya, Nathan Kosiba, Douglas Sanders, Spencer Childress, Li Ge, Zhongkai Wang, Colleen McLaughlin, Chelsea Dickens, Maya Gans, Jacob Anderson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

