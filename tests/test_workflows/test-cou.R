# Tests based on tests/testthat/test-RunWorkflow.R. If something breaks
# here, check whether that has changed.

test_that("cou workflows work", {
  workflow_data <- get_workflow_data("cou")
  results <- workflow_data$results
  workflows <- workflow_data$workflows
  yaml_outputs <- workflow_data$yaml_outputs

  expect_no_error({
    purrr::iwalk(
      workflows,
      function(this_workflow, this_name) {
        expect_identical(
          this_workflow, results[[this_name]][names(this_workflow)]
        )
      }
    )
  })

  expect_no_error({
    purrr::iwalk(
      results,
      function(this_result, this_name) {
        expect_setequal(yaml_outputs[[this_name]], names(this_result$lData))
      }
    )
  })

  expect_no_error({
    purrr::iwalk(
      yaml_outputs,
      function(this_output_set, this_name) {
        expect_true(
          all(map_int(results[[this_name]]$lData[this_output_set], NROW) > 0)
        )
      }
    )
  })
})
