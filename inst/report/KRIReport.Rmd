---
title: "Assessment Overview"
subtitle: "Generated with the Gilead Statistical Monitoring {gsm} package"
date: "Report Generated on: `r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
     toc: true
     toc_float: true
     css: styles.css
params:
    study: NA
---

```{r, results='asis', echo = FALSE, message=FALSE, warning = FALSE}
library(gsm)
library(tidyverse)
library(DT)

study <- params$study

overview_table <- Overview_Table(study) 

```

# Study Overview

```{r echo=FALSE, warning=FALSE}
overview_table
```

# Results

```{r, echo = FALSE, results='asis'}



# for (i in seq_along(study)) {
# 
#   title <- gsm::meta_workflow %>% 
#     filter(workflowid == study[[i]]$name) %>% 
#     pull(metric)
#   
#   print(htmltools::h1(title))
#   print(htmltools::h2("Summary Charts"))
#     for (chart in study[[i]]$lResults$lCharts) {
#     browser()
#     print(chart)
#   }
# }

for (i in seq_along(study)) {
  
  title <- gsm::meta_workflow %>% 
    filter(workflowid == study[[i]]$name) %>% 
    pull(metric)
  
  print(htmltools::h1(title))
  print(htmltools::h2("Summary Charts"))
  print(htmltools::tags$button(class = 'btn-show-report', htmltools::tags$i(class = "fa fa-cloud"), "Show Plots"))
  
  for (chart in seq_along(study[[i]]$lResults$lCharts)) {
    cat(paste0("<div class =", names(study[[i]]$lResults$lCharts)[[chart]], ">"))
    print(study[[i]]$lResults$lCharts[[chart]])
    cat("</div>")
  }

}
```

```{js, echo = FALSE}
document.querySelectorAll(".barScore").forEach(function (el) {
  el.style.display = "none";
});

document.querySelectorAll(".barMetric").forEach(function (el) {
  el.style.display = "none";
});

const btnReport = document.querySelectorAll(".btn-show-report");
const barMetric = document.querySelectorAll(".barMetric");
const barScore = document.querySelectorAll(".barScore");

btnReport.forEach(function (el) {
  el.addEventListener("click", function () {
    barMetric.forEach(function (chart) {
      let displayStyle = chart.style.display === "none" ? null : "none";
      chart.style.display = displayStyle;

      let buttonText = displayStyle === "none" ? "Show Plots" : "Hide Plots";

      btnReport.forEach(function (text) {
        text.textContent = buttonText;
      });
    });

    barScore.forEach(function (chart) {
      let displayStyle = chart.style.display === "none" ? null : "none";
      chart.style.display = displayStyle;
    });
  });
});

```
