---
title: "GSM - Treatment Discontinuation Deep Dive"
subtitle: "Generated with the Good Statistical Monitoring {gsm} package"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    css: styles.css
params:
  demographics: NA
  study: NA
  treatment: NA
  mapping: NA
  method: NA
---

```{r setup, include=FALSE}
library(flexdashboard)
library(gsm)
library(DT)
library(gt)
library(dplyr)
library(plotly)
library(glue)
library(htmltools)
```

```{r}
## Create data --------------------------------------------------------
dfInput_study <- Disc_Study_Map(params$study, params$mapping)

dfInput_treat <- Disc_Treatment_Map(params$treatment, params$mapping)

```

Study
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(params$study$studyid))

# Snapshot
h4(strong("Snapshot:"))
cat(as.character(Sys.Date()))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(params$study$subjectid))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------

```{r results='asis'}
tab_title("Study Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
# Ploting
disc_study <- Disp_Map_Raw(dfs = list(
                                   dfSUBJ = params$demographics,
                                   dfSTUDCOMP = params$study,
                                   dfSDRGCOMP = params$treatment
                                   ),
                           lMapping = params$mapping, 
                           strContext = "Study")

disc_study_assessment <- Disp_Assess(disc_study, strMethod = params$method, bMakeCharts = TRUE)

disc_study_assessment$lCharts$scatterJS

```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
disc_study_assessment$lCharts$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
disc_study_assessment$lCharts$barScoreJS
```

Bar Plot
----------------------------------------------------------------
### <font size=5px>**Study Discontinuation Reasons**</font> 

```{r}
Disc_Bar_Plot(dfInput_study, strGroup = "Study")
```

Bar Plot by Site
----------------------------------------------------------------
### <font size=5px>**Study Discontinuation Reasons by Site**</font>
```{r}
Disc_Bar_Plot(dfInput_study, strGroup = "Site")
```

Table
----------------------------------------------------------------
### <font size=5px>**Study Discontinuation Reasons Summary**</font> 

```{r}
dfInput_study %>%
  filter(!is.empty(`Discontinuation Reason`)) %>%
  datatable(rownames = FALSE)

```


Treatment
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(params$study$studyid))

# Snapshot
h4(strong("Snapshot:"))
cat(as.character(Sys.Date()))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(params$treatment$subjectid))

```

Scatter Plot2 {.tabset .tabset-fade}
----------------------------------------------------------------

```{r results='asis'}
tab_title("Treatment Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
# Ploting
disc_treatment <- Disp_Map_Raw(dfs = list(
                                   dfSUBJ = params$demographics,
                                   dfSTUDCOMP = params$study,
                                   dfSDRGCOMP = params$treatment
                                   ),
                           lMapping = params$mapping, 
                           strContext = "Treatment")

disc_treatment_assessment <- Disp_Assess(disc_treatment, strMethod = params$method, bMakeCharts = TRUE)

disc_treatment_assessment$lCharts$scatterJS

```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
disc_treatment_assessment$lCharts$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
disc_treatment_assessment$lCharts$barScoreJS
```

Bar Plot
----------------------------------------------------------------
### <font size=5px>**Study-wide Treatment Discontinuation Reasons**</font> 

```{r}
Disc_Bar_Plot(dfInput_treat, strGroup = "Study")
```

Bar Plot by Site
----------------------------------------------------------------
### <font size=5px>**Treatment Discontinuation Reasons by Site**</font>
```{r}
Disc_Bar_Plot(dfInput_treat, strGroup = "Site")
```

Table
----------------------------------------------------------------
### <font size=5px>**Treatment Discontinuation Reasons Summary**</font> 

```{r}
dfInput_treat %>%
  filter(!is.empty(`Discontinuation Reason`)) %>%
  datatable(rownames = FALSE)

```


