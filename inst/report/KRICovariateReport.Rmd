---
title: "GSM - Treatment Discontinuation Deep Dive"
subtitle: "Generated with the Good Statistical Monitoring {gsm} package"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    css: styles.css
params:
  snapshot: NA
---

```{r setup, include=FALSE}
library(flexdashboard)
library(gsm)
library(DT)
library(gt)
library(dplyr)
library(plotly)
library(glue)
library(htmltools)
devtools::load_all()
```

```{r}
## Create data --------------------------------------------------------
dist_list <- list(
  kri0001 = c("dfAE", "mdrsoc_nsv"),
  kri0002 = c("dfAE", "mdrsoc_nsv"),
  kri0003 = c("dfPD", "companycategory"),
  kri0004 = c("dfPD", "companycategory"),
  kri0005 = c("dfLB", "lbtstnam"),
  kri0006 = c("dfSTUDCOMP", "compreas"),
  kri0007 = c("dfSDRGCOMP", "sdrgreas"),
  #kri0008 = params$snapshot$lInputs$lData$dfAE, #?
  kri0009 = c("dfQUERY", "formoid"),
  kri0010 = c("dfDATAENT", "formoid"),
  kri0011 = c("dfDATACHG", "formoid"),
  kri0012 = c("dfENROLL", "sfreas")
)

lInput <- Distribution_Map(params$snapshot, dist_list)
plots <- Distribution_Charts(lInput)

```

AE Reporting Rate
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(lInput$kri0001$study$`Study ID`))

# Snapshot
h4(strong("Snapshot:"))
cat(as.character(snapshot$lSnapshotDate))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(lInput$kri0001$site$`Subject ID`))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------
```{r results='asis'}
tab_title("AE Reporting Rate by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
snapshot$lCharts$kri0001$scatterJS
```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
snapshot$lCharts$kri0001$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
snapshot$lCharts$kri0001$barScoreJS
```

Bar Plot Study
----------------------------------------------------------------
```{r}
fig_bar_study <- round(length(unique(lInput$kri0001$study$Metric))/3)
fig_bar_site <- round(length(unique(lInput$kri0001$site$`Site ID`))/3)
```

### <font size=5px>**Study-wide Adverse Effects**</font> 
```{r fig.height={fig_bar_study} }
plots$kri0001$study
```

Bar Plot Site 
----------------------------------------------------------------

### <font size=5px>**Site-wide Adverse Effects**</font>
```{r fig.height={fig_bar_site} }
plots$kri0001$site
```

Table
----------------------------------------------------------------

### <font size=5px>**AE Reasons Summary**</font> 
```{r}
lInput$kri0001$site %>%
  datatable(rownames = FALSE)
```



KRI0003 PD Reporting Rate
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(lInput$kri0003$study$`Study ID`))

# params$snapshot
h4(strong("params$snapshot:"))
cat(as.character(params$snapshot$lSnapshotDate))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(lInput$kri0003$site$`Subject ID`))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------
```{r results='asis'}
tab_title("Treatment Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
params$snapshot$lCharts$kri0003$scatterJS
```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
params$snapshot$lCharts$kri0003$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
params$snapshot$lCharts$kri0003$barScoreJS
```

Bar Plot Study
----------------------------------------------------------------
```{r}
fig_bar_study <- round(length(unique(lInput$kri0003$study$Metric))/3)
fig_bar_site <- round(length(unique(lInput$kri0003$site$`Site ID`))/3)
```

### <font size=5px>**Study-wide Adverse Effects**</font> 
```{r fig.height={fig_bar_study} }
plots$kri0003$study
```

Bar Plot Site 
----------------------------------------------------------------

### <font size=5px>**Site-wide Adverse Effects**</font>
```{r }
plots$kri0003$site
```

Table
----------------------------------------------------------------

### <font size=5px>**AE Reasons Summary**</font> 
```{r}
lInput$kri0003$site %>%
  datatable(rownames = FALSE)
```

KRI0004 IPD Reporting Rate
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(lInput$kri0004$study$`Study ID`))

# params$snapshot
h4(strong("params$snapshot:"))
cat(as.character(params$snapshot$lSnapshotDate))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(lInput$kri0004$site$`Subject ID`))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------
```{r results='asis'}
tab_title("Treatment Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
params$snapshot$lCharts$kri0004$scatterJS
```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
params$snapshot$lCharts$kri0004$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
params$snapshot$lCharts$kri0004$barScoreJS
```

Bar Plot Study
----------------------------------------------------------------
```{r}
fig_bar_study <- round(length(unique(lInput$kri0004$study$Metric))/3)
fig_bar_site <- round(length(unique(lInput$kri0004$site$`Site ID`))/3)
```

### <font size=5px>**Study-wide Adverse Effects**</font> 
```{r fig.height={fig_bar_study} }
plots$kri0004$study
```

Bar Plot Site 
----------------------------------------------------------------

### <font size=5px>**Site-wide Adverse Effects**</font>
```{r }
plots$kri0004$site
```

Table
----------------------------------------------------------------

### <font size=5px>**AE Reasons Summary**</font> 
```{r}
lInput$kri0004$site %>%
  datatable(rownames = FALSE)
```



KRI0005 LB Reporting Rate
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(lInput$kri0005$study$`Study ID`))

# params$snapshot
h4(strong("params$snapshot:"))
cat(as.character(params$snapshot$lSnapshotDate))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(lInput$kri0005$site$`Subject ID`))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------
```{r results='asis'}
tab_title("Treatment Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
params$snapshot$lCharts$kri0005$scatterJS
```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
params$snapshot$lCharts$kri0005$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
params$snapshot$lCharts$kri0005$barScoreJS
```

Bar Plot Study
----------------------------------------------------------------
```{r}
fig_bar_study <- round(length(unique(lInput$kri0005$study$Metric))/3)
fig_bar_site <- round(length(unique(lInput$kri0005$site$`Site ID`))/3)
```

### <font size=5px>**Study-wide Adverse Effects**</font> 
```{r fig.height={fig_bar_study} }
plots$kri0005$study
```

Bar Plot Site 
----------------------------------------------------------------

### <font size=5px>**Site-wide Adverse Effects**</font>
```{r }
plots$kri0005$site
```

Table
----------------------------------------------------------------

### <font size=5px>**AE Reasons Summary**</font> 
```{r}
lInput$kri0005$site %>%
  datatable(rownames = FALSE)
```



KRI0006 SDSC Reporting Rate
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(lInput$kri0006$study$`Study ID`))

# params$snapshot
h4(strong("params$snapshot:"))
cat(as.character(params$snapshot$lSnapshotDate))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(lInput$kri0006$site$`Subject ID`))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------
```{r results='asis'}
tab_title("Treatment Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
params$snapshot$lCharts$kri0006$scatterJS
```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
params$snapshot$lCharts$kri0006$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
params$snapshot$lCharts$kri0006$barScoreJS
```

Bar Plot Study
----------------------------------------------------------------
```{r}
fig_bar_study <- round(length(unique(lInput$kri0006$study$Metric))/3)
fig_bar_site <- round(length(unique(lInput$kri0006$site$`Site ID`))/3)
```

### <font size=5px>**Study-wide Adverse Effects**</font> 
```{r fig.height={fig_bar_study} }
plots$kri0006$study
```

Bar Plot Site 
----------------------------------------------------------------

### <font size=5px>**Site-wide Adverse Effects**</font>
```{r}
plots$kri0006$site
```

Table
----------------------------------------------------------------

### <font size=5px>**AE Reasons Summary**</font> 
```{r}
lInput$kri0006$site %>%
  datatable(rownames = FALSE)
```



KRI0007 TDSC Reporting Rate
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(lInput$kri0007$study$`Study ID`))

# params$snapshot
h4(strong("params$snapshot:"))
cat(as.character(params$snapshot$lSnapshotDate))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(lInput$kri0007$site$`Subject ID`))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------
```{r results='asis'}
tab_title("Treatment Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
params$snapshot$lCharts$kri0007$scatterJS
```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
params$snapshot$lCharts$kri0007$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
params$snapshot$lCharts$kri0007$barScoreJS
```

Bar Plot Study
----------------------------------------------------------------
```{r}
fig_bar_study <- round(length(unique(lInput$kri0007$study$Metric))/3)
fig_bar_site <- round(length(unique(lInput$kri0007$site$`Site ID`))/3)
```

### <font size=5px>**Study-wide Adverse Effects**</font> 
```{r fig.height={fig_bar_study} }
plots$kri0007$study
```

Bar Plot Site 
----------------------------------------------------------------

### <font size=5px>**Site-wide Adverse Effects**</font>
```{r }
plots$kri0007$site
```

Table
----------------------------------------------------------------

### <font size=5px>**AE Reasons Summary**</font> 
```{r}
lInput$kri0007$site %>%
  datatable(rownames = FALSE)
```



KRI0009 OQRY Reporting Rate
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(lInput$kri0009$study$`Study ID`))

# params$snapshot
h4(strong("params$snapshot:"))
cat(as.character(params$snapshot$lSnapshotDate))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(lInput$kri0009$site$`Subject ID`))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------
```{r results='asis'}
tab_title("Treatment Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
params$snapshot$lCharts$kri0009$scatterJS
```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
params$snapshot$lCharts$kri0009$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
params$snapshot$lCharts$kri0009$barScoreJS
```

Bar Plot Study
----------------------------------------------------------------
```{r}
fig_bar_study <- round(length(unique(lInput$kri0009$study$Metric))/3)
fig_bar_site <- round(length(unique(lInput$kri0009$site$`Site ID`))/3)
```

### <font size=5px>**Study-wide Adverse Effects**</font> 
```{r fig.height={fig_bar_study} }
plots$kri0009$study
```

Bar Plot Site 
----------------------------------------------------------------

### <font size=5px>**Site-wide Adverse Effects**</font>
```{r }
plots$kri0009$site
```

Table
----------------------------------------------------------------

### <font size=5px>**AE Reasons Summary**</font> 
```{r}
lInput$kri0009$site %>%
  datatable(rownames = FALSE)
```



KRI0010 ODAT Reporting Rate
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(lInput$kri0010$study$`Study ID`))

# params$snapshot
h4(strong("params$snapshot:"))
cat(as.character(params$snapshot$lSnapshotDate))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(lInput$kri0010$site$`Subject ID`))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------
```{r results='asis'}
tab_title("Treatment Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
params$snapshot$lCharts$kri0010$scatterJS
```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
params$snapshot$lCharts$kri0010$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
params$snapshot$lCharts$kri0010$barScoreJS
```

Bar Plot Study
----------------------------------------------------------------
```{r}
fig_bar_study <- round(length(unique(lInput$kri0010$study$Metric))/3)
fig_bar_site <- round(length(unique(lInput$kri0010$site$`Site ID`))/3)
```

### <font size=5px>**Study-wide Adverse Effects**</font> 
```{r fig.height={fig_bar_study} }
plots$kri0010$study
```

Bar Plot Site 
----------------------------------------------------------------

### <font size=5px>**Site-wide Adverse Effects**</font>
```{r }
plots$kri0010$site
```

Table
----------------------------------------------------------------

### <font size=5px>**AE Reasons Summary**</font> 
```{r}
lInput$kri0010$site %>%
  datatable(rownames = FALSE)
```



KRI0011 CDAT Reporting Rate
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(lInput$kri0011$study$`Study ID`))

# params$snapshot
h4(strong("params$snapshot:"))
cat(as.character(params$snapshot$lSnapshotDate))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(lInput$kri0011$site$`Subject ID`))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------
```{r results='asis'}
tab_title("Treatment Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
params$snapshot$lCharts$kri0011$scatterJS
```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
params$snapshot$lCharts$kri0011$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
params$snapshot$lCharts$kri0011$barScoreJS
```

Bar Plot Study
----------------------------------------------------------------
```{r}
fig_bar_study <- round(length(unique(lInput$kri0011$study$Metric))/3)
fig_bar_site <- round(length(unique(lInput$kri0011$site$`Site ID`))/3)
```

### <font size=5px>**Study-wide Adverse Effects**</font> 
```{r fig.height={fig_bar_study} }
plots$kri0011$study
```

Bar Plot Site 
----------------------------------------------------------------

### <font size=5px>**Site-wide Adverse Effects**</font>
```{r }
plots$kri0011$site
```

Table
----------------------------------------------------------------

### <font size=5px>**AE Reasons Summary**</font> 
```{r}
lInput$kri0011$site %>%
  datatable(rownames = FALSE)
```



KRI0012 SF Reporting Rate
================================================================

Sidebar {.sidebar}
----------------------------------------------------------------
```{r results='asis'}
# Study
h4(strong("Study:"))
cat(unique(lInput$kri0012$study$`Study ID`))

# params$snapshot
h4(strong("params$snapshot:"))
cat(as.character(params$snapshot$lSnapshotDate))

# Total Patients
h4(strong("Total Patients:"))
cat(n_distinct(lInput$kri0012$site$`Subject ID`))

```

Scatter Plot {.tabset .tabset-fade}
----------------------------------------------------------------
```{r results='asis'}
tab_title("Treatment Discontinuation by Site")
```

### <font size=3px>**Scatter Plot**</font> 
```{r}
params$snapshot$lCharts$kri0012$scatterJS
```

### <font size=3px>**Bar Plot (Metric)**</font> 
```{r}
params$snapshot$lCharts$kri0012$barMetricJS
```

### <font size=3px>**Bar Plot (Score)**</font> 
```{r}
params$snapshot$lCharts$kri0012$barScoreJS
```

Bar Plot Study
----------------------------------------------------------------
```{r}
fig_bar_study <- round(length(unique(lInput$kri0012$study$Metric))/3)
fig_bar_site <- round(length(unique(lInput$kri0012$site$`Site ID`))/3)
```

### <font size=5px>**Study-wide Adverse Effects**</font> 
```{r fig.height={fig_bar_study} }
plots$kri0012$study
```

Bar Plot Site 
----------------------------------------------------------------

### <font size=5px>**Site-wide Adverse Effects**</font>
```{r }
plots$kri0012$site
```

Table
----------------------------------------------------------------

### <font size=5px>**AE Reasons Summary**</font> 
```{r}
lInput$kri0012$site %>%
  datatable(rownames = FALSE)
```



