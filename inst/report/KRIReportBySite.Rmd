---
subtitle: "Generated with the Good Statistical Monitoring {gsm} package"
output:
  html_document:
    toc: true
    toc_float:
       collapsed: false
       smooth_scroll: true
    css: styles.css
params:
    assessment: NA
    status_study: NA
    status_site: NA
    status_snap: NA
    longitudinal: NULL
---

```{r, results='asis', echo=FALSE, message=FALSE, warning=FALSE}
library(gsm)
library(DT)

setup <- MakeReportSetup(
  assessment = params$assessment, 
  dfSite = params$status_site,
  strType = "kri"
)

```

---
title: "`r setup$study_id` Assessment Overview"
---

::: {#overall-site-select .overall-site-select title="Selected site will be highlighted in all charts for all KRIs."}
:::

```{r, echo=FALSE, results='asis'}
## metadata report if longitudinal data is provided
status_study_exists <- exists('status_study', where = params) && !is.null(params$status_study)
if (status_study_exists) {
  date <- GetSnapshotDate(params$status_study)
}
```

```{r, echo=FALSE, results='asis', eval=status_study_exists, fig.height=2}
MakeStudyStatusTable(dfStudy = params$status_study, overview_raw_table = setup$overview_raw_table, longitudinal = params$longitudinal)
Make_Timeline(status_study = params$status_study, longitudinal = params$longitudinal)
```

## Study Overview

::: flag-container
::: {.flag .flag-red}
`r setup$red_kris` Red KRIs
:::

::: {.flag .flag-amber}
`r setup$amber_kris` Amber KRIs
:::
:::

::: gsm-overview-table
```{r echo=FALSE, warning=FALSE}
setup$overview_table
```

`r if(length(setup$dropped) > 0){glue::glue("{length(setup$dropped)} {ifelse(length(setup$dropped) == 1, 'KRI', 'KRIs')} dropped in Report see [KRI Glossary]")}`

:::

```{r, echo=FALSE, results = 'asis', eval=status_study_exists}
MakeOverviewMessage(
  report = "site",
  status_study = params$status_study,
  overview_raw_table = setup$overview_raw_table, 
  red_kris = setup$red_kris
)

```

## Results

```{r, echo=FALSE, results='asis'}
MakeResultsTable(setup$active,
                 setup$summary_table)
```

## KRI Glossary

```{r, echo = FALSE}
MakeKRIGlossary(
  strWorkflowIDs = names(setup$active),
  lStatus = params$status_snap
)
```

## Error Log

```{r echo = FALSE}
MakeErrorLog(setup$active)
```

`r if(!is.null(setup$dropped)){"## Inactive KRI's"}`

```{r, echo=FALSE, results='asis', eval=!is.null(setup$dropped)}
if(length(setup$dropped) > 0){
MakeResultsTable(setup$dropped,
                 setup$dropped_summary_table)
}
if(length(setup$dropped) == 0){
  cat("No Inactive KRI's")
}
```


```{js, file='../utils-0.0.1/overallSiteDropdown.js', echo=FALSE}
```

```{js, file='../utils-0.0.1/dragOverallSiteDropdown.js', echo=FALSE}
```

```{js, file='../utils-0.0.1/showMetaTableDetails.js', echo=FALSE}
```
