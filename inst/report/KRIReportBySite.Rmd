---

subtitle: "Generated with the Good Statistical Monitoring {gsm} package"
output:
  html_document:
    toc: true
    toc_float:
       collapsed: false
       smooth_scroll: true
    css: styles.css
params:
  lCharts: NA
  dfSummary: NA
  dfStudy: NA
  dfSite: NA
  dfMetrics: NA

---

```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```


```{r, results='asis', echo=FALSE, message=FALSE, warning=FALSE}
library(gsm)
library(DT)

setup <- Report_Setup(dfStudy =  params$dfStudy)

```

---
title: "`r setup$study_id` Metric Overview"
--- 

date: "Snapshot Date: `r setup$snapshot_date`

::: {#overall-site-select .overall-site-select title="Selected site will be highlighted in all charts for all KRIs."}
:::

```{r, echo=FALSE, results='asis', fig.height=2}
Report_StudyInfo(dfStudy = params$dfStudy)
```

## Study Overview

::: flag-container
::: {.flag .flag-red}
<div> `r setup$red_kris` Red KRIs </div>
:::

::: {.flag .flag-amber}
<div> `r setup$amber_kris` Amber KRIs </div>
:::
:::

::: gsm-overview-table


```{r echo=FALSE, warning=FALSE}
htmltools::div(
  style = "table-layout: fixed; width: 100%; overflow: auto;",
  Widget_SiteOverview(dfSummary=dfSummary %>% rename_with(tolower) %>% mutate(workflowid=metricid), dfSite=dfSite)
)
```

:::

```{r, echo=FALSE, results = 'asis'}
#MakeOverviewMessage(
#  report = "site",
#  status_study = params$status_study,
#  overview_raw_table = setup$overview_raw_table, 
#  red_kris = setup$red_kris
#)

```

## Results

```{r, echo=FALSE, results='asis'}
for (i in seq_along(lCharts)) {
  MetricID <- names(lCharts)[[i]]

  print(htmltools::h3(MetricID))
  
  Report_MetricCharts(
    lCharts = lCharts[[i]]
  )

  dfMetricSummary <- params$dfSummary[params$dfSummary$MetricID == MetricID,]
  cat(Report_SummaryTable(dfSummary = dfMetricSummary, dfSite= dfSite))
  #summaryTable <- Report_SummaryTable(dfSummary = dfMetricSummary, dfSite= dfSite)
  #kbl(summaryTable, format="html", escape=FALSE)%>%kable_minimal()%>%print

}

```

```{r echo=FALSE}
site_dropdown <- system.file('utils-0.0.1', 'overallSiteDropdown.js', package = "gsm")
dropdown_drag <- system.file('utils-0.0.1', 'dragOverallSiteDropdown.js', package = "gsm")
meta_details <- system.file('utils-0.0.1', 'showMetaTableDetails.js', package = "gsm")
```

```{js, file={site_dropdown}, echo=FALSE}
```

```{js, file={dropdown_drag}, echo=FALSE}
```

```{js, file={meta_details}, echo=FALSE}
```
