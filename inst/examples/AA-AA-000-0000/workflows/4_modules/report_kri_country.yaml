meta:
  Type: Report 
  ID: report_kri_country
  Output: html
  Name: Country-Level Key Risk Indicator Report
  Description: A report summarizing key risk indicators at the country level.
spec:
  Reporting_Results:
    _all:
      required: true
    Numerator:
      type: numeric
    Denominator:
      type: numeric
    Metric:
      type: numeric
    Score:
      type: numeric
    Flag:
      type: numeric
  Reporting_Metrics:
    _all:
      required: true
  Reporting_Groups:
    _all:
      required: true
  Reporting_Bounds:
    _all:
      required: true
    Threshold:
      type: numeric
    Numerator:
      type: numeric
    Denominator:
      type: numeric
    LogDenominator:
      type: numeric
    Metric:
      type: numeric
steps:
  - name: RunQuery
    output: Reporting_Results_Country
    params:
      df: Reporting_Results
      strQuery: "SELECT * FROM df WHERE GroupLevel == 'Country'"
  - name: RunQuery
    output: Reporting_Metrics_Country
    params:
      df: Reporting_Metrics
      strQuery: "SELECT * FROM df WHERE GroupLevel == 'Country'"
  - name: MakeCharts
    output: lCharts_Country
    params:
      dfResults: Reporting_Results_Country
      dfGroups: Reporting_Groups
      dfBounds: Reporting_Bounds
      dfMetrics: Reporting_Metrics_Country
  - output: SnapshotDate
    name: pull
    params:
      .data: Reporting_Results
      var: SnapshotDate
  - output: SnapshotDate
    name: unique
    params:
      x: SnapshotDate
  - output: strOutputDir
    name: paste
    params:
      modules: modules
      SnapshotDate: SnapshotDate
      sep: '/'
  - output: strOutputDir
    name: normalizePath
    params:
      path: strOutputDir
  - name: Report_KRI
    output: lReport
    params:
      lCharts: lCharts_Country
      dfResults: Reporting_Results_Country
      dfGroups: Reporting_Groups
      dfMetrics: Reporting_Metrics_Country
      strOutputDir: strOutputDir

