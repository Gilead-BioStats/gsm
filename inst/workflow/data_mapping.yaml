meta:
  File: mapping.yaml
  description: Data Mappings to prepare for metric calculations
spec:
  Raw_SUBJ:
    subjectid:
      required: true
      type: character
    subjid:
      required: true
      type: character
    invid:
      required: true
      type: character
    country:
      required: true
      type: character
    timeonstudy:
      required: true
      type: numeric
    subject_nsv:
      required: true
      type: character
    studyid:
      required: true
      type: character
  Raw_AE:
    subjid:
      required: true
      type: character
    aeser:
      required: true
      type: character
  Raw_PD:
    subjectenrollmentnumber:
      required: true
      type: character
    deemedimportant:
      required: true
      type: character
  Raw_LB:
    subjid:
      required: true
      type: character
    toxgrg_nsv:
      required: true
      type: character
  Raw_STUDCOMP:
    subjid:
      required: true
      type: character
    compyn:
      required: true
      type: character
  Raw_SDRGCOMP:
    subjid:
      required: true
      type: character
    sdrgyn:
      required: true
      type: character
    phase:
      required: true
      type: character
  Raw_QUERY:
    subjectname:
      required: true
      type: character
    querystatus:
      required: true
      type: character
    queryage:
      required: true
      type: numeric
  Raw_DATAENT:
    subjectname:
      required: true
      type: character
    data_entry_lag:
      required: true
      type: numeric
  Raw_DATACHG:
    subjectname:
      required: true
      type: character
    n_changes:
      required: true
      type: numeric
  Raw_ENROLL:
    subjid:
      required: true
      type: character
    invid:
      required: true
      type: character
    country:
      required: true
      type: character
    enrollyn:
      required: true
      type: character
steps:
  - name: RunQuery
    output: Mapped_ENROLL
    params:
      df: Raw_SUBJ
      strQuery: "SELECT subjectid as raw_subjectid, subjid, invid, country, timeonstudy, subject_nsv, studyid FROM df WHERE enrollyn == 'Y'"
  - name: RunQuery
    output: Mapped_AE
    params:
      df: Raw_AE
      strQuery: "SELECT subjid, aeser FROM df"
  - name: RunQuery
    output: Mapped_PD
    params:
      df: Raw_PD
      strQuery: "SELECT subjectenrollmentnumber as subjid, deemedimportant FROM df"
  - name: RunQuery
    output: Mapped_LB
    params:
      df: Raw_LB
      strQuery: "SELECT subjid, toxgrg_nsv FROM df"
  - name: RunQuery
    output: Mapped_STUDCOMP
    params:
      df: Raw_STUDCOMP
      strQuery: "SELECT subjid, compyn FROM df"
  - name: RunQuery
    output: Mapped_SDRGCOMP
    params:
      df: Raw_SDRGCOMP
      strQuery: "SELECT subjid, sdrgyn, phase FROM df"
  - name: RunQuery
    output: Mapped_QUERY
    params:
      df: Raw_QUERY
      strQuery: "SELECT subjectname as subject_nsv, querystatus, queryage FROM df"
  - name: RunQuery
    output: Mapped_DATACHG
    params:
      df: Raw_DATACHG
      strQuery: "SELECT subjectname as subject_nsv, n_changes FROM df"
  - name: RunQuery
    output: Mapped_DATAENT
    params:
      df: Raw_DATAENT
      strQuery: "SELECT subjectname as subject_nsv, data_entry_lag FROM df"
  - name: RunQuery
    output: Mapped_SCREEN
    params:
      df: Raw_ENROLL
      strQuery: "SELECT subjid, invid, country, enrollyn FROM df"
