meta:
  File: 2_map.yaml
  description: Data Mappings to prepare for metric calculations
spec:
  Raw_SUBJ:
    studyid:
      required: true
      type: character
    invid:
      required: true
      type: character
    country:
      required: true
      type: character
    subjid:
      required: true
      type: character
    subject_nsv:
      required: true
      type: character
    timeonstudy:
      required: true
      type: numeric
  Raw_QUERY:
    subject_nsv:
      required: true
      type: character
    querystatus:
      required: true
      type: character
    queryage:
      required: true
      type: numeric
  Raw_DATAENT:
    subject_nsv:
      required: true
      type: character
      target_col: subject_nsv 
    data_entry_lag:
      required: true
      type: numeric
  Raw_DATACHG:
    subject_nsv:
      required: true
      type: character
      target_col: subject_nsv
    n_changes:
      required: true
      type: numeric
steps:
  - name: RunQuery
    output: Mapped_ENROLL
    params:
      df: Raw_SUBJ
      strQuery: "SELECT * FROM df WHERE enrollyn == 'Y'"
  - name: select
    output: Temp_SubjectLookup
    params:
      .data: Mapped_ENROLL
      subjid: subjid
      subject_nsv: subject_nsv
  - name: left_join
    output: Mapped_QUERY
    params:
      x: Raw_QUERY
      "y": Temp_SubjectLookup
      by: subject_nsv
  - name: left_join
    output: Mapped_DATAENT
    params:
      x: Raw_DATAENT
      "y": Temp_SubjectLookup
      by: subject_nsv
  - name: left_join
    output: Mapped_DATACHG
    params:
      x: Raw_DATACHG
      "y": Temp_SubjectLookup
      by: subject_nsv

