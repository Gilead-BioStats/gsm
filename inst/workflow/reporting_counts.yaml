meta:
  File: counts.yaml
  desctipion: participant and site counts at site- and study-level
steps:
  - name: RunQuery
    output: dfSiteCounts
    params:
      df: dfEnrolled
      strQuery: "SELECT siteid as GroupID, COUNT(DISTINCT subjectid) as nSubjects, COUNT(DISTINCT siteid) as nSites FROM df GROUP BY siteid"  
  - name: RunQuery
    output: dfStudyCounts
    params:
      df: dfEnrolled
      strQuery: "SELECT studyid as GroupID, COUNT(DISTINCT subjectid) as nSubjects, COUNT(DISTINCT siteid) as nSites FROM df GROUP BY studyid"
  - name: RunQuery
    output: dfCountryCounts   
    params:
      df: dfEnrolled
      strQuery: "SELECT country as GroupID, COUNT(DISTINCT subjectid) as nSubjects, COUNT(DISTINCT siteid) as nSites FROM df GROUP BY country"
  - name: bind_rows
    output: dfCountsWide
    params:
      Site: dfSiteCounts
      Study: dfStudyCounts
      Country: dfCountryCounts
      .id: 'GroupLevel'
  - name: pivot_longer
    output: dfCounts
    params:
      data: dfCountsWide
      cols: 
        - 'nSubjects'
        - 'nSites'
      names_to: 'Param'
      values_to: 'Value'
