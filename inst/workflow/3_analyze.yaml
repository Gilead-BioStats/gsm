meta:
  File: 3_analyze.yaml
  Description: run all metrics in a snapshot
spec:
  Mapped_SUBJ:
    _all:
      required: yes
  Mapped_STUDY:
    _all:
      required: yes
  Mapped_SITE:
    _all:
      required: yes
  Mapped_COUNTRY:
    _all:
      required: yes
  Mapped_QUERY:
    _all:
      required: yes
  Mapped_DATAENT:
    _all:
      required: yes
  Mapped_DATACHG:
    _all:
      required: yes
  Mapped_AE:
    _all:
      required: yes
  Mapped_PD:
    _all:
      required: yes
  Mapped_LB:
    _all:
      required: yes
  Mapped_STUDCOMP:
    _all:
      required: yes
  Mapped_SDRGCOMP:
    _all:
      required: yes
  Mapped_ENROLL:
    _all:
      required: yes
steps:
  # Encapsulate individual mapped data frames in a list.
  - name: <-
    output: lMapped
    params:
      lhs: lMapped
      rhs: lData

  # Run metric workflows.
  - name: MakeWorkflowList
    output: lWorkflows
    params:
      strPath: workflow/metrics
  - name: RunWorkflows
    output: lAnalysis
    params:
      lWorkflows: lWorkflows
      lData: lMapped
      bKeepInputData: FALSE

  # Set snapshot date to today.
  - name: Sys.Date
    output: dSnapshotDate
    params: {}

  # Capture study ID from the GroupID column in the study metadata.
  - name: pull
    output: GroupID
    params:
      .data: Mapped_STUDY
      var: GroupID
  - name: unique
    output: strStudyID
    params:
      x: GroupID

  # Bind results.
  - name: BindResults
    output: Analysis_Input
    params:
      lAnalysis: lAnalysis
      strName: "Analysis_Input"
      dSnapshotDate: dSnapshotDate
      strStudyID: strStudyID
  - name: BindResults
    output: Analysis_Summary
    params:
      lAnalysis: lAnalysis
      strName: "Analysis_Summary"
      dSnapshotDate: dSnapshotDate
      strStudyID: strStudyID

