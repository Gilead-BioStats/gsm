meta:
  File: reporting.yaml
  description: Generate reporting data model including site-, country- and study-level metadata (dfGroups), metric metadata (dfMetrics) and results data with added study-level columsn (dfSummary and dfBounds).
spec:
  Mapped_ENROLL:
    invid:
      required: true
    subjid:
      required: true
    studyid:
      required: true
    country:
      required: true
  Analysis_Summary:
    _all:
      required: true
steps:
  # Combine CTMS and Counts data as dfGroups
  - name: bind_rows
    output: Reporting_Groups
    params:
      SiteCounts: Temp_SiteCounts
      StudyCounts: Temp_StudyCounts
      CountryCounts: Temp_CountryCounts
      Site: Temp_CTMSSite
      Study: Temp_CTMSStudy

# Create Metric Medatadata
  - name: MakeMetric
    output: Reporting_Metrics
    params:
      lWorkflows: lWorkflows

# Stack dfSummary data into dfResults
  - name: BindResults
    output: Reporting_Results
    params:
      lAnalysis: lAnalysis
      strName: "Analysis_Summary"
      dSnapshotDate: dSnapshotDate
      strStudyID: strStudyID

# Calculate Bounds for confidence intervals
  - name: MakeBounds
    output: Reporting_Bounds
    params:
      dfResults: Reporting_Results
      dfMetrics: Reporting_Metrics

